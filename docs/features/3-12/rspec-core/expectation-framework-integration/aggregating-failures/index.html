<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1" name="viewport" /><meta property="og:title" /><meta content="https://rspec.info/features/3-12/rspec-core/expectation-framework-integration/aggregating-failures/" property="og:url" /><meta content="https://rspec.info/images/logo_ogp.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="@rspec" name="twitter:site" /><title></title><link href="/stylesheets/pages/features.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" /></head><body class="features"><header><nav><h1><img src="/images/logo.png" alt="Logo" /><a href="/">RSpec</a></h1><input class="hamburger-toggle" type="checkbox" /><div class="hamburger-icon"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><ul class="menu"><li><a href="/about">About</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/blog">Blog</a></li><li><a href="/upgrading-from-rspec-2">Upgrade</a></li><li><a href="/help">Get Help</a></li><li><a href="/contributing">Contributing</a></li></ul></nav></header><nav class="top-nav-bar" role="navigation"><ul><li>Library:</li><li><a class="title" href="/features/3-12/rspec-core">RSpec Core</a><ul aria-haspopup="true" aria-label="submenu"><li class="current"><a href="/features/3-12/rspec-core">RSpec Core</a></li><li><a href="/features/3-12/rspec-expectations">RSpec Expectations</a></li><li><a href="/features/3-12/rspec-mocks">RSpec Mocks</a></li><li><a href="/features/6-1/rspec-rails">RSpec Rails</a></li></ul></li><li>Version:</li><li><a class="title" href="/features/3-12/rspec-core">3.12</a><ul aria-haspopup="true" aria-label="submenu"><li><a href="/features/3-13/rspec-core">3.13</a></li><li class="current"><a href="/features/3-12/rspec-core">3.12</a></li></ul></li></ul></nav><section><nav><ul><li><a href="/features/3-12/rspec-core/example-groups/">Example groups</a><ul><li><a href="/features/3-12/rspec-core/example-groups/basic-structure/"> The basic structure (`describe`/`it`)</a></li><li><a href="/features/3-12/rspec-core/example-groups/shared-examples/"> Using shared examples</a></li><li><a href="/features/3-12/rspec-core/example-groups/shared-context/"> Using `shared_context`</a></li><li><a href="/features/3-12/rspec-core/example-groups/aliasing/"> Aliasing</a></li></ul></li><li><a href="/features/3-12/rspec-core/command-line/">Command line</a><ul><li><a href="/features/3-12/rspec-core/command-line/example-name-option/"> `--example` option</a></li><li><a href="/features/3-12/rspec-core/command-line/format-option/"> `--format` option</a></li><li><a href="/features/3-12/rspec-core/command-line/tag/"> `--tag` option</a></li><li><a href="/features/3-12/rspec-core/command-line/line-number-appended-to-path/"> `&lt;file&gt;:&lt;line_number&gt;` (line number appended to file path)</a></li><li><a href="/features/3-12/rspec-core/command-line/exit-status/"> `--failure-exit-code` option (exit status)</a></li><li><a href="/features/3-12/rspec-core/command-line/order/">`--order` option</a></li><li><a href="/features/3-12/rspec-core/command-line/rake-task/"> Creating a rake task</a></li><li><a href="/features/3-12/rspec-core/command-line/order/"> Using the `--order` option</a></li><li><a href="/features/3-12/rspec-core/command-line/ruby/"> Run with `ruby` command</a></li><li><a href="/features/3-12/rspec-core/command-line/warnings-option/"> `--warnings` option (run with warnings enabled)</a></li><li><a href="/features/3-12/rspec-core/command-line/init/"> `--init` option</a></li><li><a href="/features/3-12/rspec-core/command-line/example-matches-name-option/"> `--example-matches` option</a></li><li><a href="/features/3-12/rspec-core/command-line/bisect/"> Bisect</a></li><li><a href="/features/3-12/rspec-core/command-line/only-failures/"> Using the `--only-failures` option</a></li><li><a href="/features/3-12/rspec-core/command-line/fail-fast/"> `--fail-fast` option</a></li><li><a href="/features/3-12/rspec-core/command-line/dry-run/"> `--dry-run` option</a></li><li><a href="/features/3-12/rspec-core/command-line/randomization/"> Randomization can be reproduced across test runs</a></li><li><a href="/features/3-12/rspec-core/command-line/pattern-option/"> `--pattern` option</a></li><li><a href="/features/3-12/rspec-core/command-line/require-option/"> `--require` option</a></li></ul></li><li><a href="/features/3-12/rspec-core/pending-and-skipped-examples/">Pending and skipped examples</a><ul><li><a href="/features/3-12/rspec-core/pending-and-skipped-examples/pending-examples/"> Using `pending` with examples</a></li><li><a href="/features/3-12/rspec-core/pending-and-skipped-examples/skipped-examples/"> Using `skip` with examples</a></li></ul></li><li><a href="/features/3-12/rspec-core/hooks/">Hooks</a><ul><li><a href="/features/3-12/rspec-core/hooks/before-and-after-hooks/"> `before` and `after` hooks</a></li><li><a href="/features/3-12/rspec-core/hooks/around-hooks/"> `around` hooks</a></li><li><a href="/features/3-12/rspec-core/hooks/filtering/"> Filtering</a></li><li><a href="/features/3-12/rspec-core/hooks/when-first-matching-example-defined/"> Using `when_first_matching_example_defined` hook</a></li></ul></li><li><a href="/features/3-12/rspec-core/subject/">Subject</a><ul><li><a href="/features/3-12/rspec-core/subject/implicit-subject/"> Implicitly defined subject</a></li><li><a href="/features/3-12/rspec-core/subject/explicit-subject/"> Explicit Subject</a></li><li><a href="/features/3-12/rspec-core/subject/one-liner-syntax/"> One-liner syntax</a></li></ul></li><li><a href="/features/3-12/rspec-core/helper-methods/">Helper methods</a><ul><li><a href="/features/3-12/rspec-core/helper-methods/let/"> `let` and `let!`</a></li><li><a href="/features/3-12/rspec-core/helper-methods/arbitrary-methods/"> Defining arbitrary helper methods</a></li><li><a href="/features/3-12/rspec-core/helper-methods/modules/"> Define helper methods in a module</a></li></ul></li><li><a href="/features/3-12/rspec-core/metadata/">Metadata</a><ul><li><a href="/features/3-12/rspec-core/metadata/current-example/"> Using the current example</a></li><li><a href="/features/3-12/rspec-core/metadata/described-class/"> Using `described_class`</a></li><li><a href="/features/3-12/rspec-core/metadata/user-defined/"> User-defined metadata</a></li><li><a href="/features/3-12/rspec-core/metadata/current-scope/"> `RSpec` provides the current scope as `RSpec.current_scope`</a></li></ul></li><li><a href="/features/3-12/rspec-core/filtering/">Filtering</a><ul><li><a href="/features/3-12/rspec-core/filtering/inclusion-filters/"> Inclusion filters</a></li><li><a href="/features/3-12/rspec-core/filtering/exclusion-filters/"> Exclusion filters</a></li><li><a href="/features/3-12/rspec-core/filtering/if-and-unless/"> Conditional Filters</a></li><li><a href="/features/3-12/rspec-core/filtering/filter-run-when-matching/"> Using `filter_run_when_matching`</a></li></ul></li><li><a href="/features/3-12/rspec-core/configuration/">Configuration</a><ul><li><a href="/features/3-12/rspec-core/configuration/read-options-from-file/"> Reading command line configuration options from files</a></li><li><a href="/features/3-12/rspec-core/configuration/color/"> Windows may require additional solutions to display color</a></li><li><a href="/features/3-12/rspec-core/configuration/fail-fast/"> Setting the `fail_fast` option</a></li><li><a href="/features/3-12/rspec-core/configuration/fail-if-no-examples/"> Setting the `fail_if_no_examples` option</a></li><li><a href="/features/3-12/rspec-core/configuration/custom-settings/"> Custom settings</a></li><li><a href="/features/3-12/rspec-core/configuration/alias-example-to/"> Create example aliases</a></li><li><a href="/features/3-12/rspec-core/configuration/default-path/"> Setting the default spec path</a></li><li><a href="/features/3-12/rspec-core/configuration/pattern/"> Using the `--pattern` option</a></li><li><a href="/features/3-12/rspec-core/configuration/run-all-when-everything-filtered/"> Using `run_all_when_everything_filtered`</a></li><li><a href="/features/3-12/rspec-core/configuration/overriding-global-ordering/"> Overriding global ordering</a></li><li><a href="/features/3-12/rspec-core/configuration/profile/"> Profiling examples (`--profile`)</a></li><li><a href="/features/3-12/rspec-core/configuration/error-exit-code/"> Setting an error exit code</a></li><li><a href="/features/3-12/rspec-core/configuration/failure-exit-code/"> Setting a failure exit code</a></li><li><a href="/features/3-12/rspec-core/configuration/order-and-seed/"> Setting the `--order` and/or `--seed`</a></li><li><a href="/features/3-12/rspec-core/configuration/exclude-pattern/"> Using the `--exclude_pattern` option</a></li><li><a href="/features/3-12/rspec-core/configuration/enable-global-dsl/"> Global namespace DSL</a></li><li><a href="/features/3-12/rspec-core/configuration/deprecation-stream/"> Custom deprecation stream</a></li><li><a href="/features/3-12/rspec-core/configuration/output-stream/"> Custom output stream</a></li><li><a href="/features/3-12/rspec-core/configuration/backtrace-exclusion-patterns/"> Excluding lines from the backtrace</a></li><li><a href="/features/3-12/rspec-core/configuration/zero-monkey-patching-mode/"> Zero monkey patching mode</a></li></ul></li><li><a href="/features/3-12/rspec-core/expectation-framework-integration/">Expectation framework integration</a><ul class="open"><li><a href="/features/3-12/rspec-core/expectation-framework-integration/configure-expectation-framework/"> Configuring an expectation framework</a></li><li><a href="/features/3-12/rspec-core/expectation-framework-integration/aggregating-failures/"> Aggregating Failures</a></li></ul></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/">Mock framework integration</a><ul><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-rspec/"> Mocking with `rspec`</a></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-flexmock/"> Mocking with `flexmock`</a></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-mocha/"> Mocking with `mocha`</a></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-rr/"> Mocking with `rr`</a></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-any-framework/"> Mocking with an alternative framework</a></li></ul></li><li><a href="/features/3-12/rspec-core/formatters/">Formatters</a><ul><li><a href="/features/3-12/rspec-core/formatters/configurable-colors/"> Configurable colors</a></li><li><a href="/features/3-12/rspec-core/formatters/json-formatter/"> The JSON formatter</a></li><li><a href="/features/3-12/rspec-core/formatters/custom-formatter/"> Custom formatters</a></li></ul></li><li><a href="/features/3-12/rspec-core/spec-files/">Spec files</a><ul><li><a href="/features/3-12/rspec-core/spec-files/arbitrary-file-suffix/"> Using an arbitrary file suffix</a></li></ul></li><li><a href="/features/3-12/rspec-core/core-standalone/">Core standalone</a></li><li><a href="/features/3-12/rspec-core/clear-examples/">Clear examples</a></li></ul></nav><article><h1>Aggregating Failures</h1>

<p>RSpec::Expectations provides <a href="/features/3-12/rspec-expectations/aggregating-failures/"><code>aggregate_failures</code></a>, an API that allows you to group a set of expectations and see all the failures at once, rather than it aborting on the first failure. RSpec::Core improves on this feature in a couple of ways:</p>
<div class="highlight"><pre class="highlight plaintext"><code>* RSpec::Core provides much better failure output, adding code snippets and backtraces to the sub-failures, just like it does for any normal failure.
* RSpec::Core provides [metadata](../metadata/user-defined-metadata) integration for this feature. Each example that is tagged with `:aggregate_failures` will be wrapped in an `aggregate_failures` block. You can also use `config.define_derived_metadata` to apply this to every example automatically.
</code></pre></div>
<p>The metadata form is quite convenient, but may not work well for end-to-end tests that have multiple distinct steps. For example, consider a spec for an HTTP client workflow that (1) makes a request, (2) expects a redirect, (3) follows the redirect, and (4) expects a particular response.  You probably want the <code>expect(response.status).to be_between(300, 399)</code> expectation to immediately abort if it fails, because you can&rsquo;t perform the next step (following the redirect) if that is not satisfied. For these situations, we encourage you to use the <code>aggregate_failures</code> block form to wrap each set of expectations that represents a distinct step in the test workflow.</p>

<h2>Background</h2>

<p><em>Given</em> a file named &ldquo;lib/client.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">Response</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:status</span><span class="p">,</span> <span class="ss">:headers</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Client</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">make_request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">'/'</span><span class="p">)</span>
    <span class="no">Response</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="p">{</span> <span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"text/plain"</span> <span class="p">},</span> <span class="s2">"Not Found"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2>Use <code>aggregate_failures</code> block form</h2>

<p><em>Given</em> a file named &ldquo;spec/use<em>block</em>form_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">after</span> <span class="k">do</span>
    <span class="c1"># this should be appended to failure list</span>
    <span class="n">expect</span><span class="p">(</span><span class="kp">false</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="kp">true</span><span class="p">),</span> <span class="s2">"after hook failure"</span>
  <span class="k">end</span>

  <span class="n">around</span> <span class="k">do</span> <span class="o">|</span><span class="n">ex</span><span class="o">|</span>
    <span class="n">ex</span><span class="p">.</span><span class="nf">run</span>
    <span class="c1"># this should also be appended to failure list</span>
    <span class="n">expect</span><span class="p">(</span><span class="kp">false</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="kp">true</span><span class="p">),</span> <span class="s2">"around hook failure"</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"returns a successful response"</span> <span class="k">do</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">aggregate_failures</span> <span class="s2">"testing response"</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/json"</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Success"}'</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/use_block_form_spec.rb</code></p>

<p><em>Then</em> it should fail and list all the failures:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Failures:

  1) Client returns a successful response
     Got 3 failures:

     1.1) Got 3 failures from failure aggregation block "testing response".
          # ./spec/use_block_form_spec.rb:18
          # ./spec/use_block_form_spec.rb:10

          1.1.1) Failure/Error: expect(response.status).to eq(200)

                   expected: 200
                        got: 404

                   (compared using ==)
                 # ./spec/use_block_form_spec.rb:19

          1.1.2) Failure/Error: expect(response.headers).to include("Content-Type" =&gt; "application/json")
                   expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Type" =&gt; "application/json"}
                   Diff:
                   @@ -1 +1 @@
                   -"Content-Type" =&gt; "application/json",
                   +"Content-Type" =&gt; "text/plain",
                 # ./spec/use_block_form_spec.rb:20

          1.1.3) Failure/Error: expect(response.body).to eq('{"message":"Success"}')

                   expected: "{\"message\":\"Success\"}"
                        got: "Not Found"

                   (compared using ==)
                 # ./spec/use_block_form_spec.rb:21

     1.2) Failure/Error: expect(false).to be(true), "after hook failure"
            after hook failure
          # ./spec/use_block_form_spec.rb:6
          # ./spec/use_block_form_spec.rb:10

     1.3) Failure/Error: expect(false).to be(true), "around hook failure"
            around hook failure
          # ./spec/use_block_form_spec.rb:12
</code></pre></div>
<h2>Use <code>aggregate_failures</code> block form</h2>

<p><em>Given</em> a file named &ldquo;spec/use<em>block</em>form_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">after</span> <span class="k">do</span>
    <span class="c1"># this should be appended to failure list</span>
    <span class="n">expect</span><span class="p">(</span><span class="kp">false</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="kp">true</span><span class="p">),</span> <span class="s2">"after hook failure"</span>
  <span class="k">end</span>

  <span class="n">around</span> <span class="k">do</span> <span class="o">|</span><span class="n">ex</span><span class="o">|</span>
    <span class="n">ex</span><span class="p">.</span><span class="nf">run</span>
    <span class="c1"># this should also be appended to failure list</span>
    <span class="n">expect</span><span class="p">(</span><span class="kp">false</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="kp">true</span><span class="p">),</span> <span class="s2">"around hook failure"</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"returns a successful response"</span> <span class="k">do</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">aggregate_failures</span> <span class="s2">"testing response"</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/json"</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Success"}'</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/use_block_form_spec.rb</code></p>

<p><em>Then</em> it should fail and list all the failures:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Failures:

  1) Client returns a successful response
     Got 3 failures:

     1.1) Got 3 failures from failure aggregation block "testing response".
          # ./spec/use_block_form_spec.rb:18
          # ./spec/use_block_form_spec.rb:10

          1.1.1) Failure/Error: expect(response.status).to eq(200)

                   expected: 200
                        got: 404

                   (compared using ==)
                 # ./spec/use_block_form_spec.rb:19

          1.1.2) Failure/Error: expect(response.headers).to include("Content-Type" =&gt; "application/json")
                   expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Type" =&gt; "application/json"}
                   Diff:
                   @@ -1,2 +1,2 @@
                   -"Content-Type" =&gt; "application/json",
                   +"Content-Type" =&gt; "text/plain",
                 # ./spec/use_block_form_spec.rb:20

          1.1.3) Failure/Error: expect(response.body).to eq('{"message":"Success"}')

                   expected: "{\"message\":\"Success\"}"
                        got: "Not Found"

                   (compared using ==)
                 # ./spec/use_block_form_spec.rb:21

     1.2) Failure/Error: expect(false).to be(true), "after hook failure"
            after hook failure
          # ./spec/use_block_form_spec.rb:6
          # ./spec/use_block_form_spec.rb:10

     1.3) Failure/Error: expect(false).to be(true), "around hook failure"
            around hook failure
          # ./spec/use_block_form_spec.rb:12
</code></pre></div>
<h2>Use <code>:aggregate_failures</code> metadata</h2>

<p><em>Given</em> a file named &ldquo;spec/use<em>metadata</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"follows a redirect"</span><span class="p">,</span> <span class="ss">:aggregate_failures</span> <span class="k">do</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">302</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Redirect"}'</span><span class="p">)</span>

    <span class="n">redirect_response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s1">'Location'</span><span class="p">))</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">redirect_response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">redirect_response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"OK"}'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/use_metadata_spec.rb</code></p>

<p><em>Then</em> it should fail and list all the failures:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Failures:

  1) Client follows a redirect
     Got 2 failures and 1 other error:

     1.1) Failure/Error: expect(response.status).to eq(302)

            expected: 302
                 got: 404

            (compared using ==)
          # ./spec/use_metadata_spec.rb:7

     1.2) Failure/Error: expect(response.body).to eq('{"message":"Redirect"}')

            expected: "{\"message\":\"Redirect\"}"
                 got: "Not Found"

            (compared using ==)
          # ./spec/use_metadata_spec.rb:8

     1.3) Failure/Error: redirect_response = Client.make_request(response.headers.fetch('Location'))
          KeyError:
            key not found: "Location"
          # ./spec/use_metadata_spec.rb:10
          # ./spec/use_metadata_spec.rb:10
</code></pre></div>
<h2>Enable failure aggregation globally using <code>define_derived_metadata</code></h2>

<p><em>Given</em> a file named &ldquo;spec/enable<em>globally</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">define_derived_metadata</span> <span class="k">do</span> <span class="o">|</span><span class="n">meta</span><span class="o">|</span>
    <span class="n">meta</span><span class="p">[</span><span class="ss">:aggregate_failures</span><span class="p">]</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"returns a successful response"</span> <span class="k">do</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/json"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Success"}'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/enable_globally_spec.rb</code></p>

<p><em>Then</em> it should fail and list all the failures:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Failures:

  1) Client returns a successful response
     Got 3 failures:

     1.1) Failure/Error: expect(response.status).to eq(200)

            expected: 200
                 got: 404

            (compared using ==)
          # ./spec/enable_globally_spec.rb:13

     1.2) Failure/Error: expect(response.headers).to include("Content-Type" =&gt; "application/json")
            expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Type" =&gt; "application/json"}
            Diff:
            @@ -1 +1 @@
            -"Content-Type" =&gt; "application/json",
            +"Content-Type" =&gt; "text/plain",
          # ./spec/enable_globally_spec.rb:14

     1.3) Failure/Error: expect(response.body).to eq('{"message":"Success"}')

            expected: "{\"message\":\"Success\"}"
                 got: "Not Found"

            (compared using ==)
          # ./spec/enable_globally_spec.rb:15
</code></pre></div>
<h2>Enable failure aggregation globally using <code>define_derived_metadata</code></h2>

<p><em>Given</em> a file named &ldquo;spec/enable<em>globally</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">define_derived_metadata</span> <span class="k">do</span> <span class="o">|</span><span class="n">meta</span><span class="o">|</span>
    <span class="n">meta</span><span class="p">[</span><span class="ss">:aggregate_failures</span><span class="p">]</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"returns a successful response"</span> <span class="k">do</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/json"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Success"}'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/enable_globally_spec.rb</code></p>

<p><em>Then</em> it should fail and list all the failures:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Failures:

  1) Client returns a successful response
     Got 3 failures:

     1.1) Failure/Error: expect(response.status).to eq(200)

            expected: 200
                 got: 404

            (compared using ==)
          # ./spec/enable_globally_spec.rb:13

     1.2) Failure/Error: expect(response.headers).to include("Content-Type" =&gt; "application/json")
            expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Type" =&gt; "application/json"}
            Diff:
            @@ -1,2 +1,2 @@
            -"Content-Type" =&gt; "application/json",
            +"Content-Type" =&gt; "text/plain",
          # ./spec/enable_globally_spec.rb:14

     1.3) Failure/Error: expect(response.body).to eq('{"message":"Success"}')

            expected: "{\"message\":\"Success\"}"
                 got: "Not Found"

            (compared using ==)
          # ./spec/enable_globally_spec.rb:15
</code></pre></div>
<h2>Nested failure aggregation works</h2>

<p><em>Given</em> a file named &ldquo;spec/nested<em>failure</em>aggregation_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"returns a successful response"</span><span class="p">,</span> <span class="ss">:aggregate_failures</span> <span class="k">do</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

    <span class="n">aggregate_failures</span> <span class="s2">"testing headers"</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/json"</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Length"</span> <span class="o">=&gt;</span> <span class="s2">"21"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Success"}'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/nested_failure_aggregation_spec.rb</code></p>

<p><em>Then</em> it should fail and list all the failures:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Failures:

  1) Client returns a successful response
     Got 3 failures:

     1.1) Failure/Error: expect(response.status).to eq(200)

            expected: 200
                 got: 404

            (compared using ==)
          # ./spec/nested_failure_aggregation_spec.rb:7

     1.2) Got 2 failures from failure aggregation block "testing headers".
          # ./spec/nested_failure_aggregation_spec.rb:9

          1.2.1) Failure/Error: expect(response.headers).to include("Content-Type" =&gt; "application/json")
                   expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Type" =&gt; "application/json"}
                   Diff:
                   @@ -1 +1 @@
                   -"Content-Type" =&gt; "application/json",
                   +"Content-Type" =&gt; "text/plain",
                 # ./spec/nested_failure_aggregation_spec.rb:10

          1.2.2) Failure/Error: expect(response.headers).to include("Content-Length" =&gt; "21")
                   expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Length" =&gt; "21"}
                   Diff:
                   @@ -1 +1 @@
                   -"Content-Length" =&gt; "21",
                   +"Content-Type" =&gt; "text/plain",
                 # ./spec/nested_failure_aggregation_spec.rb:11

     1.3) Failure/Error: expect(response.body).to eq('{"message":"Success"}')

            expected: "{\"message\":\"Success\"}"
                 got: "Not Found"

            (compared using ==)
          # ./spec/nested_failure_aggregation_spec.rb:14
</code></pre></div>
<h2>Nested failure aggregation works</h2>

<p><em>Given</em> a file named &ldquo;spec/nested<em>failure</em>aggregation_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"returns a successful response"</span><span class="p">,</span> <span class="ss">:aggregate_failures</span> <span class="k">do</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

    <span class="n">aggregate_failures</span> <span class="s2">"testing headers"</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/json"</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Length"</span> <span class="o">=&gt;</span> <span class="s2">"21"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Success"}'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/nested_failure_aggregation_spec.rb</code></p>

<p><em>Then</em> it should fail and list all the failures:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Failures:

  1) Client returns a successful response
     Got 3 failures:

     1.1) Failure/Error: expect(response.status).to eq(200)

            expected: 200
                 got: 404

            (compared using ==)
          # ./spec/nested_failure_aggregation_spec.rb:7

     1.2) Got 2 failures from failure aggregation block "testing headers".
          # ./spec/nested_failure_aggregation_spec.rb:9

          1.2.1) Failure/Error: expect(response.headers).to include("Content-Type" =&gt; "application/json")
                   expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Type" =&gt; "application/json"}
                   Diff:
                   @@ -1,2 +1,2 @@
                   -"Content-Type" =&gt; "application/json",
                   +"Content-Type" =&gt; "text/plain",
                 # ./spec/nested_failure_aggregation_spec.rb:10

          1.2.2) Failure/Error: expect(response.headers).to include("Content-Length" =&gt; "21")
                   expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Length" =&gt; "21"}
                   Diff:
                   @@ -1,2 +1,2 @@
                   -"Content-Length" =&gt; "21",
                   +"Content-Type" =&gt; "text/plain",
                 # ./spec/nested_failure_aggregation_spec.rb:11

     1.3) Failure/Error: expect(response.body).to eq('{"message":"Success"}')

            expected: "{\"message\":\"Success\"}"
                 got: "Not Found"

            (compared using ==)
          # ./spec/nested_failure_aggregation_spec.rb:14
</code></pre></div>
<h2>Mock expectation failures are aggregated as well</h2>

<p><em>Given</em> a file named &ldquo;spec/mock<em>expectation</em>failure_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Aggregating Failures"</span><span class="p">,</span> <span class="ss">:aggregate_failures</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"has a normal expectation failure and a message expectation failure"</span> <span class="k">do</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="s2">"Client"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:put</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="s2">"updated data"</span><span class="p">)</span>
    <span class="n">allow</span><span class="p">(</span><span class="n">client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:get</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="no">Response</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">"Not Found"</span><span class="p">))</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">get</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/mock_expectation_failure_spec.rb</code></p>

<p><em>Then</em> it should fail and list all the failures:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Failures:

  1) Aggregating Failures has a normal expectation failure and a message expectation failure
     Got 2 failures:

     1.1) Failure/Error: expect(response.status).to eq(200)

            expected: 200
                 got: 404

            (compared using ==)
          # ./spec/mock_expectation_failure_spec.rb:10

     1.2) Failure/Error: expect(client).to receive(:put).with("updated data")
            (Double "Client").put("updated data")
                expected: 1 time with arguments: ("updated data")
                received: 0 times
          # ./spec/mock_expectation_failure_spec.rb:6

</code></pre></div>
<h2>Pending integrates properly with aggregated failures</h2>

<p><em>Given</em> a file named &ldquo;spec/pending_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"returns a successful response"</span><span class="p">,</span> <span class="ss">:aggregate_failures</span> <span class="k">do</span>
    <span class="n">pending</span> <span class="s2">"Not yet ready"</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/json"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Success"}'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/pending_spec.rb</code></p>

<p><em>Then</em> it should pass and list all the pending examples:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Pending: (Failures listed here are expected and do not affect your suite's status)

  1) Client returns a successful response
     # Not yet ready
     Got 3 failures:

     1.1) Failure/Error: expect(response.status).to eq(200)

            expected: 200
                 got: 404

            (compared using ==)
          # ./spec/pending_spec.rb:8

     1.2) Failure/Error: expect(response.headers).to include("Content-Type" =&gt; "application/json")
            expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Type" =&gt; "application/json"}
            Diff:
            @@ -1 +1 @@
            -"Content-Type" =&gt; "application/json",
            +"Content-Type" =&gt; "text/plain",
          # ./spec/pending_spec.rb:9

     1.3) Failure/Error: expect(response.body).to eq('{"message":"Success"}')

            expected: "{\"message\":\"Success\"}"
                 got: "Not Found"

            (compared using ==)
          # ./spec/pending_spec.rb:10
</code></pre></div>
<h2>Pending integrates properly with aggregated failures</h2>

<p><em>Given</em> a file named &ldquo;spec/pending_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'client'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Client</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"returns a successful response"</span><span class="p">,</span> <span class="ss">:aggregate_failures</span> <span class="k">do</span>
    <span class="n">pending</span> <span class="s2">"Not yet ready"</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Client</span><span class="p">.</span><span class="nf">make_request</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">status</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/json"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'{"message":"Success"}'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec spec/pending_spec.rb</code></p>

<p><em>Then</em> it should pass and list all the pending examples:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Pending: (Failures listed here are expected and do not affect your suite's status)

  1) Client returns a successful response
     # Not yet ready
     Got 3 failures:

     1.1) Failure/Error: expect(response.status).to eq(200)

            expected: 200
                 got: 404

            (compared using ==)
          # ./spec/pending_spec.rb:8

     1.2) Failure/Error: expect(response.headers).to include("Content-Type" =&gt; "application/json")
            expected {"Content-Type" =&gt; "text/plain"} to include {"Content-Type" =&gt; "application/json"}
            Diff:
            @@ -1,2 +1,2 @@
            -"Content-Type" =&gt; "application/json",
            +"Content-Type" =&gt; "text/plain",
          # ./spec/pending_spec.rb:9

     1.3) Failure/Error: expect(response.body).to eq('{"message":"Success"}')

            expected: "{\"message\":\"Success\"}"
                 got: "Not Found"

            (compared using ==)
          # ./spec/pending_spec.rb:10
</code></pre></div></article></section><footer><div>Created with the assistance of Ninefold<img src="/images/brutus-half.png" alt="Brutus" /></div><br /><a href="https://dnsimple.link/resolving-rspec" target="_blank">Resolving with<br /><img src="https://cdn.dnsimple.com/assets/resolving-with-us/logo-dark.png" alt="DNSimple" style="width:100px;" /></a></footer></body><script src="/javascripts/asciinema-player.js"></script></html>