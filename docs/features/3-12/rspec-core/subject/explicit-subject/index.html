<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1" name="viewport" /><meta property="og:title" /><meta content="https://rspec.info/features/3-12/rspec-core/subject/explicit-subject/" property="og:url" /><meta content="https://rspec.info/images/logo_ogp.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="@rspec" name="twitter:site" /><title></title><link href="/stylesheets/pages/features.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" /></head><body class="features"><header><nav><h1><img src="/images/logo.png" alt="Logo" /><a href="/">RSpec</a></h1><input class="hamburger-toggle" type="checkbox" /><div class="hamburger-icon"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><ul class="menu"><li><a href="/about">About</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/blog">Blog</a></li><li><a href="/upgrading-from-rspec-2">Upgrade</a></li><li><a href="/help">Get Help</a></li><li><a href="/contributing">Contributing</a></li></ul></nav></header><nav class="top-nav-bar" role="navigation"><ul><li>Library:</li><li><a class="title" href="/features/3-12/rspec-core">RSpec Core</a><ul aria-haspopup="true" aria-label="submenu"><li class="current"><a href="/features/3-12/rspec-core">RSpec Core</a></li><li><a href="/features/3-12/rspec-expectations">RSpec Expectations</a></li><li><a href="/features/3-12/rspec-mocks">RSpec Mocks</a></li><li><a href="/features/6-1/rspec-rails">RSpec Rails</a></li></ul></li><li>Version:</li><li><a class="title" href="/features/3-12/rspec-core">3.12</a><ul aria-haspopup="true" aria-label="submenu"><li class="current"><a href="/features/3-12/rspec-core">3.12</a></li><li><a href="/features/3-13/rspec-core">3.13</a></li></ul></li></ul></nav><section><nav><ul><li><a href="/features/3-12/rspec-core/example-groups/">Example groups</a><ul><li><a href="/features/3-12/rspec-core/example-groups/basic-structure/"> The basic structure (`describe`/`it`)</a></li><li><a href="/features/3-12/rspec-core/example-groups/shared-examples/"> Using shared examples</a></li><li><a href="/features/3-12/rspec-core/example-groups/shared-context/"> Using `shared_context`</a></li><li><a href="/features/3-12/rspec-core/example-groups/aliasing/"> Aliasing</a></li></ul></li><li><a href="/features/3-12/rspec-core/command-line/">Command line</a><ul><li><a href="/features/3-12/rspec-core/command-line/example-name-option/"> `--example` option</a></li><li><a href="/features/3-12/rspec-core/command-line/format-option/"> `--format` option</a></li><li><a href="/features/3-12/rspec-core/command-line/tag/"> `--tag` option</a></li><li><a href="/features/3-12/rspec-core/command-line/line-number-appended-to-path/"> `&lt;file&gt;:&lt;line_number&gt;` (line number appended to file path)</a></li><li><a href="/features/3-12/rspec-core/command-line/exit-status/"> `--failure-exit-code` option (exit status)</a></li><li><a href="/features/3-12/rspec-core/command-line/order/">`--order` option</a></li><li><a href="/features/3-12/rspec-core/command-line/rake-task/"> Creating a rake task</a></li><li><a href="/features/3-12/rspec-core/command-line/order/"> Using the `--order` option</a></li><li><a href="/features/3-12/rspec-core/command-line/ruby/"> Run with `ruby` command</a></li><li><a href="/features/3-12/rspec-core/command-line/warnings-option/"> `--warnings` option (run with warnings enabled)</a></li><li><a href="/features/3-12/rspec-core/command-line/init/"> `--init` option</a></li><li><a href="/features/3-12/rspec-core/command-line/example-matches-name-option/"> `--example-matches` option</a></li><li><a href="/features/3-12/rspec-core/command-line/bisect/"> Bisect</a></li><li><a href="/features/3-12/rspec-core/command-line/only-failures/"> Using the `--only-failures` option</a></li><li><a href="/features/3-12/rspec-core/command-line/fail-fast/"> `--fail-fast` option</a></li><li><a href="/features/3-12/rspec-core/command-line/dry-run/"> `--dry-run` option</a></li><li><a href="/features/3-12/rspec-core/command-line/randomization/"> Randomization can be reproduced across test runs</a></li><li><a href="/features/3-12/rspec-core/command-line/pattern-option/"> `--pattern` option</a></li><li><a href="/features/3-12/rspec-core/command-line/require-option/"> `--require` option</a></li></ul></li><li><a href="/features/3-12/rspec-core/pending-and-skipped-examples/">Pending and skipped examples</a><ul><li><a href="/features/3-12/rspec-core/pending-and-skipped-examples/pending-examples/"> Using `pending` with examples</a></li><li><a href="/features/3-12/rspec-core/pending-and-skipped-examples/skipped-examples/"> Using `skip` with examples</a></li></ul></li><li><a href="/features/3-12/rspec-core/hooks/">Hooks</a><ul><li><a href="/features/3-12/rspec-core/hooks/before-and-after-hooks/"> `before` and `after` hooks</a></li><li><a href="/features/3-12/rspec-core/hooks/around-hooks/"> `around` hooks</a></li><li><a href="/features/3-12/rspec-core/hooks/filtering/"> Filtering</a></li><li><a href="/features/3-12/rspec-core/hooks/when-first-matching-example-defined/"> Using `when_first_matching_example_defined` hook</a></li></ul></li><li><a href="/features/3-12/rspec-core/subject/">Subject</a><ul class="open"><li><a href="/features/3-12/rspec-core/subject/implicit-subject/"> Implicitly defined subject</a></li><li><a href="/features/3-12/rspec-core/subject/explicit-subject/"> Explicit Subject</a></li><li><a href="/features/3-12/rspec-core/subject/one-liner-syntax/"> One-liner syntax</a></li></ul></li><li><a href="/features/3-12/rspec-core/helper-methods/">Helper methods</a><ul><li><a href="/features/3-12/rspec-core/helper-methods/let/"> `let` and `let!`</a></li><li><a href="/features/3-12/rspec-core/helper-methods/arbitrary-methods/"> Defining arbitrary helper methods</a></li><li><a href="/features/3-12/rspec-core/helper-methods/modules/"> Define helper methods in a module</a></li></ul></li><li><a href="/features/3-12/rspec-core/metadata/">Metadata</a><ul><li><a href="/features/3-12/rspec-core/metadata/current-example/"> Using the current example</a></li><li><a href="/features/3-12/rspec-core/metadata/described-class/"> Using `described_class`</a></li><li><a href="/features/3-12/rspec-core/metadata/user-defined/"> User-defined metadata</a></li><li><a href="/features/3-12/rspec-core/metadata/current-scope/"> `RSpec` provides the current scope as `RSpec.current_scope`</a></li></ul></li><li><a href="/features/3-12/rspec-core/filtering/">Filtering</a><ul><li><a href="/features/3-12/rspec-core/filtering/inclusion-filters/"> Inclusion filters</a></li><li><a href="/features/3-12/rspec-core/filtering/exclusion-filters/"> Exclusion filters</a></li><li><a href="/features/3-12/rspec-core/filtering/if-and-unless/"> Conditional Filters</a></li><li><a href="/features/3-12/rspec-core/filtering/filter-run-when-matching/"> Using `filter_run_when_matching`</a></li></ul></li><li><a href="/features/3-12/rspec-core/configuration/">Configuration</a><ul><li><a href="/features/3-12/rspec-core/configuration/read-options-from-file/"> Reading command line configuration options from files</a></li><li><a href="/features/3-12/rspec-core/configuration/color/"> Windows may require additional solutions to display color</a></li><li><a href="/features/3-12/rspec-core/configuration/fail-fast/"> Setting the `fail_fast` option</a></li><li><a href="/features/3-12/rspec-core/configuration/fail-if-no-examples/"> Setting the `fail_if_no_examples` option</a></li><li><a href="/features/3-12/rspec-core/configuration/custom-settings/"> Custom settings</a></li><li><a href="/features/3-12/rspec-core/configuration/alias-example-to/"> Create example aliases</a></li><li><a href="/features/3-12/rspec-core/configuration/default-path/"> Setting the default spec path</a></li><li><a href="/features/3-12/rspec-core/configuration/pattern/"> Using the `--pattern` option</a></li><li><a href="/features/3-12/rspec-core/configuration/run-all-when-everything-filtered/"> Using `run_all_when_everything_filtered`</a></li><li><a href="/features/3-12/rspec-core/configuration/overriding-global-ordering/"> Overriding global ordering</a></li><li><a href="/features/3-12/rspec-core/configuration/profile/"> Profiling examples (`--profile`)</a></li><li><a href="/features/3-12/rspec-core/configuration/error-exit-code/"> Setting an error exit code</a></li><li><a href="/features/3-12/rspec-core/configuration/failure-exit-code/"> Setting a failure exit code</a></li><li><a href="/features/3-12/rspec-core/configuration/order-and-seed/"> Setting the `--order` and/or `--seed`</a></li><li><a href="/features/3-12/rspec-core/configuration/exclude-pattern/"> Using the `--exclude_pattern` option</a></li><li><a href="/features/3-12/rspec-core/configuration/enable-global-dsl/"> Global namespace DSL</a></li><li><a href="/features/3-12/rspec-core/configuration/deprecation-stream/"> Custom deprecation stream</a></li><li><a href="/features/3-12/rspec-core/configuration/output-stream/"> Custom output stream</a></li><li><a href="/features/3-12/rspec-core/configuration/backtrace-exclusion-patterns/"> Excluding lines from the backtrace</a></li><li><a href="/features/3-12/rspec-core/configuration/zero-monkey-patching-mode/"> Zero monkey patching mode</a></li></ul></li><li><a href="/features/3-12/rspec-core/expectation-framework-integration/">Expectation framework integration</a><ul><li><a href="/features/3-12/rspec-core/expectation-framework-integration/configure-expectation-framework/"> Configuring an expectation framework</a></li><li><a href="/features/3-12/rspec-core/expectation-framework-integration/aggregating-failures/"> Aggregating Failures</a></li></ul></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/">Mock framework integration</a><ul><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-rspec/"> Mocking with `rspec`</a></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-flexmock/"> Mocking with `flexmock`</a></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-mocha/"> Mocking with `mocha`</a></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-rr/"> Mocking with `rr`</a></li><li><a href="/features/3-12/rspec-core/mock-framework-integration/use-any-framework/"> Mocking with an alternative framework</a></li></ul></li><li><a href="/features/3-12/rspec-core/formatters/">Formatters</a><ul><li><a href="/features/3-12/rspec-core/formatters/configurable-colors/"> Configurable colors</a></li><li><a href="/features/3-12/rspec-core/formatters/json-formatter/"> The JSON formatter</a></li><li><a href="/features/3-12/rspec-core/formatters/custom-formatter/"> Custom formatters</a></li></ul></li><li><a href="/features/3-12/rspec-core/spec-files/">Spec files</a><ul><li><a href="/features/3-12/rspec-core/spec-files/arbitrary-file-suffix/"> Using an arbitrary file suffix</a></li></ul></li><li><a href="/features/3-12/rspec-core/core-standalone/">Core standalone</a></li><li><a href="/features/3-12/rspec-core/clear-examples/">Clear examples</a></li></ul></nav><article><h1>Explicit Subject</h1>

<p>Use <code>subject</code> in the group scope to explicitly define the value that is returned by the
  <code>subject</code> method in the example scope.</p>

<p>Note that while the examples below demonstrate how the <code>subject</code> helper can be used
  as a user-facing concept, we recommend that you reserve it for support of custom
  matchers and/or extension libraries that hide its use from examples.</p>

<p>A named <code>subject</code> improves on the explicit <code>subject</code> by assigning it a contextually
  semantic name. Since a named <code>subject</code> is an explicit <code>subject</code>, it still defines the value
  that is returned by the <code>subject</code> method in the example scope. However, it defines an
  additional helper method with the provided name. This helper method is memoized.
  The value is cached across multiple calls in the same example but not across examples.</p>

<p>We recommend using the named helper method over <code>subject</code> in examples.</p>

<p>For more information about declaring a <code>subject</code> see the <a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/MemoizedHelpers/ClassMethods#subject-instance_method">API docs</a>.</p>

<h2>A <code>subject</code> can be defined and used in the top level group scope</h2>

<p><em>Given</em> a file named &ldquo;top<em>level</em>subject_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Array</span><span class="p">,</span> <span class="s2">"with some elements"</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"has the prescribed elements"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec top_level_subject_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>

<h2>The <code>subject</code> defined in an outer group is available to inner groups</h2>

<p><em>Given</em> a file named &ldquo;nested<em>subject</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Array</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">"has some elements"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"which are the prescribed elements"</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec nested_subject_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>

<h2>The <code>subject</code> is memoized within an example but not across examples</h2>

<p><strong>Note:</strong> This scenario shows mutation being performed in a <code>subject</code> definition block. This
    behavior is generally discouraged as it makes it more difficult to understand the specs.
    This is technique is used simply as a tool to demonstrate how the memoization occurs.</p>

<p><em>Given</em> a file named &ldquo;memoized<em>subject</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Array</span> <span class="k">do</span>
  <span class="c1"># This uses a context local variable. As you can see from the</span>
  <span class="c1"># specs, it can mutate across examples. Use with caution.</span>
  <span class="n">element_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">element_list</span><span class="p">.</span><span class="nf">pop</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"is memoized across calls (i.e. the block is invoked once)"</span> <span class="k">do</span>
    <span class="n">expect</span> <span class="p">{</span>
      <span class="mi">3</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="n">subject</span> <span class="p">}</span>
    <span class="p">}.</span><span class="nf">to</span> <span class="n">change</span><span class="p">{</span> <span class="n">element_list</span> <span class="p">}.</span><span class="nf">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]).</span><span class="nf">to</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"is not memoized across examples"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">{</span> <span class="n">subject</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">change</span><span class="p">{</span> <span class="n">element_list</span> <span class="p">}.</span><span class="nf">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]).</span><span class="nf">to</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec memoized_subject_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>

<h2>The <code>subject</code> is available in <code>before</code> hooks</h2>

<p><em>Given</em> a file named &ldquo;before<em>hook</em>subject_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Array</span><span class="p">,</span> <span class="s2">"with some elements"</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="p">[]</span> <span class="p">}</span>

  <span class="n">before</span> <span class="p">{</span> <span class="n">subject</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"has the prescribed elements"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec before_hook_subject_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>

<h2>Helper methods can be invoked from a <code>subject</code> definition block</h2>

<p><em>Given</em> a file named &ldquo;helper<em>subject</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">Array</span><span class="p">,</span> <span class="s2">"with some elements"</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">prepared_array</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">prepared_array</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"has the prescribed elements"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec helper_subject_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>

<h2>Use the <code>subject!</code> bang method to call the definition block before the example</h2>

<p><em>Given</em> a file named &ldquo;subject<em>bang</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"eager loading with subject!"</span> <span class="k">do</span>
  <span class="n">subject!</span> <span class="p">{</span> <span class="n">element_list</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:element_list</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"calls the definition block before the example"</span> <span class="k">do</span>
    <span class="n">element_list</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">element_list</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec subject_bang_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>

<h2>Use <code>subject(:name)</code> to define a memoized helper method</h2>

<p><strong>Note:</strong> While a global variable is used in the examples below, this behavior is strongly
    discouraged in actual specs. It is used here simply to demonstrate the value will be
    cached across multiple calls in the same example but not across examples.</p>

<p><em>Given</em> a file named &ldquo;named<em>subject</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="vg">$count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"named subject"</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:global_count</span><span class="p">)</span> <span class="p">{</span> <span class="vg">$count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"is memoized across calls (i.e. the block is invoked once)"</span> <span class="k">do</span>
    <span class="n">expect</span> <span class="p">{</span>
      <span class="mi">2</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="n">global_count</span> <span class="p">}</span>
    <span class="p">}.</span><span class="nf">not_to</span> <span class="n">change</span><span class="p">{</span> <span class="n">global_count</span> <span class="p">}.</span><span class="nf">from</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"is not cached across examples"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">global_count</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"is still available using the subject method"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"works with the one-liner syntax"</span> <span class="k">do</span>
    <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"the subject and named helpers return the same object"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">global_count</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"is set to the block return value (i.e. the global $count)"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">global_count</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="vg">$count</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec named_subject_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>

<h2>Use <code>subject!(:name)</code> to define a helper method called before the example</h2>

<p><em>Given</em> a file named &ldquo;named<em>subject</em>bang_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"eager loading using a named subject!"</span> <span class="k">do</span>
  <span class="n">subject!</span><span class="p">(</span><span class="ss">:updated_list</span><span class="p">)</span> <span class="p">{</span> <span class="n">element_list</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:element_list</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"calls the definition block before the example"</span> <span class="k">do</span>
    <span class="n">element_list</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">element_list</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">updated_list</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="n">element_list</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec named_subject_bang_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>
</article></section><footer><div>Created with the assistance of Ninefold<img src="/images/brutus-half.png" alt="Brutus" /></div><br /><a href="https://dnsimple.link/resolving-rspec" target="_blank">Resolving with<br /><img src="https://cdn.dnsimple.com/assets/resolving-with-us/logo-dark.png" alt="DNSimple" style="width:100px;" /></a></footer></body><script src="/javascripts/asciinema-player.js"></script></html>