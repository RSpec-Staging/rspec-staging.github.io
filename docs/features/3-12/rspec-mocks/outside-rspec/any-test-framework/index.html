<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1" name="viewport" /><meta property="og:title" /><meta content="https://rspec.info/features/3-12/rspec-mocks/outside-rspec/any-test-framework/" property="og:url" /><meta content="https://rspec.info/images/logo_ogp.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="@rspec" name="twitter:site" /><title></title><link href="/stylesheets/pages/features.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" /></head><body class="features"><header><nav><h1><img src="/images/logo.png" alt="Logo" /><a href="/">RSpec</a></h1><input class="hamburger-toggle" type="checkbox" /><div class="hamburger-icon"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><ul class="menu"><li><a href="/about">About</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/blog">Blog</a></li><li><a href="/upgrading-from-rspec-2">Upgrade</a></li><li><a href="/help">Get Help</a></li><li><a href="/contributing">Contributing</a></li></ul></nav></header><nav class="top-nav-bar" role="navigation"><ul><li>Library:</li><li><a class="title" href="/features/3-12/rspec-mocks">RSpec Mocks</a><ul aria-haspopup="true" aria-label="submenu"><li><a href="/features/3-12/rspec-core">RSpec Core</a></li><li><a href="/features/3-12/rspec-expectations">RSpec Expectations</a></li><li class="current"><a href="/features/3-12/rspec-mocks">RSpec Mocks</a></li><li><a href="/features/6-0/rspec-rails">RSpec Rails</a></li></ul></li><li>Version:</li><li><a class="title" href="/features/3-12/rspec-mocks">3.12</a><ul aria-haspopup="true" aria-label="submenu"><li class="current"><a href="/features/3-12/rspec-mocks">3.12</a></li></ul></li></ul></nav><section><nav><ul><li><a href="/features/3-12/rspec-mocks/basics/">Basics</a><ul><li><a href="/features/3-12/rspec-mocks/basics/test-doubles/"> Test Doubles</a></li><li><a href="/features/3-12/rspec-mocks/basics/allowing-messages/"> Allowing messages</a></li><li><a href="/features/3-12/rspec-mocks/basics/expecting-messages/"> Expecting messages</a></li><li><a href="/features/3-12/rspec-mocks/basics/partial-test-doubles/"> Partial test doubles</a></li><li><a href="/features/3-12/rspec-mocks/basics/null-object-doubles/"> Null object doubles</a></li><li><a href="/features/3-12/rspec-mocks/basics/spies/"> Spies</a></li><li><a href="/features/3-12/rspec-mocks/basics/scope/"> Scope</a></li></ul></li><li><a href="/features/3-12/rspec-mocks/verifying-doubles/">Verifying doubles</a><ul><li><a href="/features/3-12/rspec-mocks/verifying-doubles/instance-doubles/"> Using an instance double</a></li><li><a href="/features/3-12/rspec-mocks/verifying-doubles/class-doubles/"> Using a class double</a></li><li><a href="/features/3-12/rspec-mocks/verifying-doubles/object-doubles/"> Using an object double</a></li><li><a href="/features/3-12/rspec-mocks/verifying-doubles/dynamic-classes/"> Dynamic classes</a></li><li><a href="/features/3-12/rspec-mocks/verifying-doubles/partial-doubles/"> Partial doubles</a></li></ul></li><li><a href="/features/3-12/rspec-mocks/configuring-responses/">Configuring responses</a><ul><li><a href="/features/3-12/rspec-mocks/configuring-responses/returning-a-value/"> Returning a value</a></li><li><a href="/features/3-12/rspec-mocks/configuring-responses/raising-an-error/"> Raising an error</a></li><li><a href="/features/3-12/rspec-mocks/configuring-responses/throwing/"> Throwing</a></li><li><a href="/features/3-12/rspec-mocks/configuring-responses/yielding/"> Yielding</a></li><li><a href="/features/3-12/rspec-mocks/configuring-responses/calling-the-original-implementation/"> Calling the original implementation</a></li><li><a href="/features/3-12/rspec-mocks/configuring-responses/wrapping-the-original-implementation/"> Wrapping the original implementation</a></li><li><a href="/features/3-12/rspec-mocks/configuring-responses/block-implementation/"> Block implementation</a></li><li><a href="/features/3-12/rspec-mocks/configuring-responses/mixed-responses/"> Mixed responses</a></li></ul></li><li><a href="/features/3-12/rspec-mocks/setting-constraints/">Setting constraints</a><ul><li><a href="/features/3-12/rspec-mocks/setting-constraints/matching-arguments/"> Matching arguments</a></li><li><a href="/features/3-12/rspec-mocks/setting-constraints/receive-counts/"> Receive Counts</a></li><li><a href="/features/3-12/rspec-mocks/setting-constraints/message-order/"> Message Order</a></li></ul></li><li><a href="/features/3-12/rspec-mocks/mutating-constants/">Mutating constants</a><ul><li><a href="/features/3-12/rspec-mocks/mutating-constants/stub-defined-constant/"> Stub Defined Constant</a></li><li><a href="/features/3-12/rspec-mocks/mutating-constants/stub-undefined-constant/"> Stub Undefined Constant</a></li><li><a href="/features/3-12/rspec-mocks/mutating-constants/hide-defined-constant/"> Hide Defined Constant</a></li><li><a href="/features/3-12/rspec-mocks/mutating-constants/hide-undefined-constant/"> Hide Undefined Constant</a></li></ul></li><li><a href="/features/3-12/rspec-mocks/working-with-legacy-code/">Working with legacy code</a><ul><li><a href="/features/3-12/rspec-mocks/working-with-legacy-code/any-instance/"> Any Instance</a></li><li><a href="/features/3-12/rspec-mocks/working-with-legacy-code/message-chains/"> Message Chains</a></li></ul></li><li><a href="/features/3-12/rspec-mocks/old-syntax/">Old syntax</a><ul><li><a href="/features/3-12/rspec-mocks/old-syntax/stub/"> `stub`</a></li><li><a href="/features/3-12/rspec-mocks/old-syntax/should-receive/"> `should_receive`</a></li><li><a href="/features/3-12/rspec-mocks/old-syntax/any-instance/"> `any_instance`</a></li><li><a href="/features/3-12/rspec-mocks/old-syntax/stub-chain/"> `stub_chain`</a></li><li><a href="/features/3-12/rspec-mocks/old-syntax/unstub/"> Using `unstub`</a></li></ul></li><li><a href="/features/3-12/rspec-mocks/outside-rspec/">Outside rspec</a><ul class="open"><li><a href="/features/3-12/rspec-mocks/outside-rspec/minitest/"> Integrating with Minitest</a></li><li><a href="/features/3-12/rspec-mocks/outside-rspec/any-test-framework/"> Integrating with any test framework</a></li><li><a href="/features/3-12/rspec-mocks/outside-rspec/standalone/"> Using `rspec-mocks` on its own outside of RSpec (standalone mode)</a></li></ul></li></ul></nav><article><h1>Integrating with any test framework</h1>

<p>rspec-mocks is a stand-alone gem that can be integrated with any test framework. The
  example below demonstrates using rspec-mocks with <a href="http://docs.seattlerb.org/minitest/">minitest</a>, but these steps
  would apply when integrating rspec-mocks with any library or framework:</p>
<div class="highlight"><pre class="highlight plaintext"><code>* Include `RSpec::Mocks::ExampleMethods` in your test context. This provides rspec-mocks' API.
* Call `RSpec::Mocks.setup` before a test begins.
* Call `RSpec::Mocks.verify` after a test completes to verify message expectations. Note
  that this step is optional; rspec-core, for example, skips this when an example has already failed.
* Call `RSpec::Mocks.teardown` after a test completes (and after `verify`) to cleanup. This
  _must_ be called, even if an error has occurred, so it generally goes in an `ensure` clause.
</code></pre></div>
<p>Note: if you are using minitest, you&rsquo;ll probably want to use the built-in <a href="/features/3-12/rspec-mocks/outside-rspec/minitest/">minitest integration</a>.</p>

<h2>Use rspec-mocks with Minitest</h2>

<p><em>Given</em> a file named &ldquo;test/test_helper.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'minitest/autorun'</span>
<span class="nb">require</span> <span class="s1">'rspec/mocks'</span>

<span class="k">module</span> <span class="nn">MinitestRSpecMocksIntegration</span>
  <span class="kp">include</span> <span class="o">::</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Mocks</span><span class="o">::</span><span class="no">ExampleMethods</span>

  <span class="k">def</span> <span class="nf">before_setup</span>
    <span class="o">::</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Mocks</span><span class="p">.</span><span class="nf">setup</span>
    <span class="k">super</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">after_teardown</span>
    <span class="k">super</span>
    <span class="o">::</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Mocks</span><span class="p">.</span><span class="nf">verify</span>
  <span class="k">ensure</span>
    <span class="o">::</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Mocks</span><span class="p">.</span><span class="nf">teardown</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">MinitestRSpecMocksIntegration</span><span class="p">)</span>
</code></pre></div>
<p><em>And</em> a file named &ldquo;test/rspec<em>mocks</em>test.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">RSpecMocksTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">test_passing_positive_expectation</span>
    <span class="n">dbl</span> <span class="o">=</span> <span class="n">double</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:message</span><span class="p">)</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">message</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_failing_positive_expectation</span>
    <span class="n">dbl</span> <span class="o">=</span> <span class="n">double</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:message</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_passing_negative_expectation</span>
    <span class="n">dbl</span> <span class="o">=</span> <span class="n">double</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to_not</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:message</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_failing_negative_expectation</span>
    <span class="n">dbl</span> <span class="o">=</span> <span class="n">double</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to_not</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:message</span><span class="p">)</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">message</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_passing_positive_spy_expectation</span>
    <span class="n">bond</span> <span class="o">=</span> <span class="n">spy</span>
    <span class="n">bond</span><span class="p">.</span><span class="nf">james</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">bond</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_received</span><span class="p">(</span><span class="ss">:james</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_failing_positive_spy_expectation</span>
    <span class="n">bond</span> <span class="o">=</span> <span class="n">spy</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">bond</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_received</span><span class="p">(</span><span class="ss">:james</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_passing_negative_spy_expectation</span>
    <span class="n">bond</span> <span class="o">=</span> <span class="n">spy</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">bond</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">have_received</span><span class="p">(</span><span class="ss">:james</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_failing_negative_spy_expectation</span>
    <span class="n">bond</span> <span class="o">=</span> <span class="n">spy</span>
    <span class="n">bond</span><span class="p">.</span><span class="nf">james</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">bond</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">have_received</span><span class="p">(</span><span class="ss">:james</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>ruby -Itest test/rspec_mocks_test.rb</code></p>

<p><em>Then</em> it should fail with the following output:</p>

<table><thead>
<tr>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>1) Error:</td>
</tr>
<tr>
<td>RSpecMocksTest#test<em>failing</em>negative_expectation:</td>
</tr>
<tr>
<td>RSpec::Mocks::MockExpectationError: (Double (anonymous)).message(no args)</td>
</tr>
<tr>
<td>expected: 0 times with any arguments</td>
</tr>
<tr>
<td>received: 1 time</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>2) Error:</td>
</tr>
<tr>
<td>RSpecMocksTest#test<em>failing</em>positive_expectation:</td>
</tr>
<tr>
<td>RSpec::Mocks::MockExpectationError: (Double (anonymous)).message(*(any args))</td>
</tr>
<tr>
<td>expected: 1 time with any arguments</td>
</tr>
<tr>
<td>received: 0 times with any arguments</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>3) Error:</td>
</tr>
<tr>
<td>RSpecMocksTest#test<em>failing</em>positive<em>spy</em>expectation:</td>
</tr>
<tr>
<td>RSpec::Mocks::MockExpectationError: (Double (anonymous)).james(*(any args))</td>
</tr>
<tr>
<td>expected: 1 time with any arguments</td>
</tr>
<tr>
<td>received: 0 times with any arguments</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>4) Error:</td>
</tr>
<tr>
<td>RSpecMocksTest#test<em>failing</em>negative<em>spy</em>expectation:</td>
</tr>
<tr>
<td>RSpec::Mocks::MockExpectationError: (Double (anonymous)).james(no args)</td>
</tr>
<tr>
<td>expected: 0 times with any arguments</td>
</tr>
<tr>
<td>received: 1 time</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>8 runs, 0 assertions, 0 failures, 4 errors, 0 skips</td>
</tr>
</tbody></table>
</article></section><footer><div>Created with the assistance of Ninefold<img src="/images/brutus-half.png" alt="Brutus" /></div><br /><a href="https://dnsimple.link/resolving-rspec" target="_blank">Resolving with<br /><img src="https://cdn.dnsimple.com/assets/resolving-with-us/logo-dark.png" alt="DNSimple" style="width:100px;" /></a></footer></body><script src="/javascripts/asciinema-player.js"></script></html>