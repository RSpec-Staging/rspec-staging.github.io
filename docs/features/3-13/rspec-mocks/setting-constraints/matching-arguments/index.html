<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1" name="viewport" /><meta property="og:title" /><meta content="https://rspec.info/features/3-13/rspec-mocks/setting-constraints/matching-arguments/" property="og:url" /><meta content="https://rspec.info/images/logo_ogp.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="@rspec" name="twitter:site" /><title></title><link href="/stylesheets/pages/features.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" /></head><body class="features"><header><nav><h1><img src="/images/logo.png" alt="Logo" /><a href="/">RSpec</a></h1><input class="hamburger-toggle" type="checkbox" /><div class="hamburger-icon"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><ul class="menu"><li><a href="/about">About</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/blog">Blog</a></li><li><a href="/upgrading-from-rspec-2">Upgrade</a></li><li><a href="/help">Get Help</a></li><li><a href="/contributing">Contributing</a></li></ul></nav></header><nav class="top-nav-bar" role="navigation"><ul><li>Library:</li><li><a class="title" href="/features/3-13/rspec-mocks">RSpec Mocks</a><ul aria-haspopup="true" aria-label="submenu"><li><a href="/features/3-13/rspec-core">RSpec Core</a></li><li><a href="/features/3-13/rspec-expectations">RSpec Expectations</a></li><li class="current"><a href="/features/3-13/rspec-mocks">RSpec Mocks</a></li><li><a href="/features/6-1/rspec-rails">RSpec Rails</a></li></ul></li><li>Version:</li><li><a class="title" href="/features/3-13/rspec-mocks">3.13</a><ul aria-haspopup="true" aria-label="submenu"><li class="current"><a href="/features/3-13/rspec-mocks">3.13</a></li><li><a href="/features/3-12/rspec-mocks">3.12</a></li></ul></li></ul></nav><section><nav><ul><li><a href="/features/3-13/rspec-mocks/basics/">Basics</a><ul><li><a href="/features/3-13/rspec-mocks/basics/test-doubles/"> Test Doubles</a></li><li><a href="/features/3-13/rspec-mocks/basics/allowing-messages/"> Allowing messages</a></li><li><a href="/features/3-13/rspec-mocks/basics/expecting-messages/"> Expecting messages</a></li><li><a href="/features/3-13/rspec-mocks/basics/partial-test-doubles/"> Partial test doubles</a></li><li><a href="/features/3-13/rspec-mocks/basics/null-object-doubles/"> Null object doubles</a></li><li><a href="/features/3-13/rspec-mocks/basics/spies/"> Spies</a></li><li><a href="/features/3-13/rspec-mocks/basics/scope/"> Scope</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/">Verifying doubles</a><ul><li><a href="/features/3-13/rspec-mocks/verifying-doubles/instance-doubles/"> Using an instance double</a></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/class-doubles/"> Using a class double</a></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/object-doubles/"> Using an object double</a></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/dynamic-classes/"> Dynamic classes</a></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/partial-doubles/"> Partial doubles</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/">Configuring responses</a><ul><li><a href="/features/3-13/rspec-mocks/configuring-responses/returning-a-value/"> Returning a value</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/raising-an-error/"> Raising an error</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/throwing/"> Throwing</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/yielding/"> Yielding</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/calling-the-original-implementation/"> Calling the original implementation</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/wrapping-the-original-implementation/"> Wrapping the original implementation</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/block-implementation/"> Block implementation</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/mixed-responses/"> Mixed responses</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/setting-constraints/">Setting constraints</a><ul class="open"><li><a href="/features/3-13/rspec-mocks/setting-constraints/matching-arguments/"> Matching arguments</a></li><li><a href="/features/3-13/rspec-mocks/setting-constraints/receive-counts/"> Receive Counts</a></li><li><a href="/features/3-13/rspec-mocks/setting-constraints/message-order/"> Message Order</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/mutating-constants/">Mutating constants</a><ul><li><a href="/features/3-13/rspec-mocks/mutating-constants/stub-defined-constant/"> Stub Defined Constant</a></li><li><a href="/features/3-13/rspec-mocks/mutating-constants/stub-undefined-constant/"> Stub Undefined Constant</a></li><li><a href="/features/3-13/rspec-mocks/mutating-constants/hide-defined-constant/"> Hide Defined Constant</a></li><li><a href="/features/3-13/rspec-mocks/mutating-constants/hide-undefined-constant/"> Hide Undefined Constant</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/working-with-legacy-code/">Working with legacy code</a><ul><li><a href="/features/3-13/rspec-mocks/working-with-legacy-code/any-instance/"> Any Instance</a></li><li><a href="/features/3-13/rspec-mocks/working-with-legacy-code/message-chains/"> Message Chains</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/old-syntax/">Old syntax</a><ul><li><a href="/features/3-13/rspec-mocks/old-syntax/stub/"> `stub`</a></li><li><a href="/features/3-13/rspec-mocks/old-syntax/should-receive/"> `should_receive`</a></li><li><a href="/features/3-13/rspec-mocks/old-syntax/any-instance/"> `any_instance`</a></li><li><a href="/features/3-13/rspec-mocks/old-syntax/stub-chain/"> `stub_chain`</a></li><li><a href="/features/3-13/rspec-mocks/old-syntax/unstub/"> Using `unstub`</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/outside-rspec/">Outside rspec</a><ul><li><a href="/features/3-13/rspec-mocks/outside-rspec/minitest/"> Integrating with Minitest</a></li><li><a href="/features/3-13/rspec-mocks/outside-rspec/any-test-framework/"> Integrating with any test framework</a></li><li><a href="/features/3-13/rspec-mocks/outside-rspec/standalone/"> Using `rspec-mocks` on its own outside of RSpec (standalone mode)</a></li></ul></li></ul></nav><article><h1>Matching arguments</h1>

<p>Use <code>with</code> to specify the expected arguments. A <a href="/features/3-13/rspec-mocks/basics/expecting-messages/">message expectation</a> constrained by <code>with</code>
  will only be satisfied when called with matching arguments. A canned response for an
  <a href="/features/3-13/rspec-mocks/basics/allowing-messages/">allowed message</a> will only be used when the arguments match.</p>

<table><thead>
<tr>
<th>To match&hellip;</th>
<th>&hellip;use an expression like:</th>
<th>&hellip;which matches calls like:</th>
</tr>
</thead><tbody>
<tr>
<td>Literal arguments</td>
<td><code>with(1, true)</code></td>
<td><code>foo(1, true)</code></td>
</tr>
<tr>
<td>Literal arguments where one is a hash</td>
<td><code>with(1, {x: 1, y: 2})</code></td>
<td>`foo(1, x: 1, y: 2) (where last argument is a hash)</td>
</tr>
<tr>
<td>Keyword arguments</td>
<td><code>with(x: 1, y: 2)</code></td>
<td><code>foo(x: 1, y: 2)</code> (where x and y are keywords)</td>
</tr>
<tr>
<td>Anything that supports case equality (<code>===</code>)</td>
<td><code>with(/bar/)</code></td>
<td><code>foo(&quot;barn&quot;)</code></td>
</tr>
<tr>
<td>Any list of args</td>
<td><code>with(any_args)</code></td>
<td><code>foo()</code><br><code>foo(1)</code><br><code>foo(:bar, 2)</code></td>
</tr>
<tr>
<td>Any sublist of args (like an arg splat)</td>
<td><code>with(1, any_args)</code></td>
<td><code>foo(1)</code><br><code>foo(1, :bar, :bazz)</code></td>
</tr>
<tr>
<td>An empty list of args</td>
<td><code>with(no_args)</code></td>
<td><code>foo()</code></td>
</tr>
<tr>
<td>Anything for a given positional arg</td>
<td><code>with(3, anything)</code></td>
<td><code>foo(3, nil)</code><br><code>foo(3, :bar)</code></td>
</tr>
<tr>
<td>Against an interface</td>
<td><code>with(duck_type(:each))</code></td>
<td><code>foo([])</code></td>
</tr>
<tr>
<td>A boolean</td>
<td><code>with(3, boolean)</code></td>
<td><code>foo(3, true)</code><br><code>foo(3, false)</code></td>
</tr>
<tr>
<td>A subset of a hash</td>
<td><code>with(hash_including(:a =&gt; 1))</code></td>
<td><code>foo(:a =&gt; 1, :b =&gt; 2)</code></td>
</tr>
<tr>
<td>An excluded subset of a hash</td>
<td><code>with(hash_excluding(:a =&gt; 1))</code></td>
<td><code>foo(:b =&gt; 2)</code></td>
</tr>
<tr>
<td>A subset of an array</td>
<td><code>with(array_including(:a, :b))</code></td>
<td><code>foo([:a, :b, :c])</code></td>
</tr>
<tr>
<td>An excluded subset of an array</td>
<td><code>with(array_excluding(:a, :b))</code></td>
<td><code>foo([:c, :d])</code></td>
</tr>
<tr>
<td>An instance of a specific class</td>
<td><code>with(instance_of(Integer))</code></td>
<td><code>foo(3)</code></td>
</tr>
<tr>
<td>An object with a given module in its ancestors list</td>
<td><code>with(kind_of(Numeric))</code></td>
<td><code>foo(3)</code></td>
</tr>
<tr>
<td>An object with matching attributes</td>
<td><code>with(having_attributes(:a =&gt; 1))</code></td>
<td><code>foo(:a =&gt; 1, :b =&gt; 2)</code></td>
</tr>
<tr>
<td>Any RSpec matcher</td>
<td><code>with(&lt;matcher&gt;)</code></td>
<td><code>foo(&lt;object that matches&gt;)</code></td>
</tr>
</tbody></table>

<h2>Basic example</h2>

<p><em>Given</em> a file named &ldquo;basic<em>example</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Constraining a message expectation using with"</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:dbl</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span> <span class="p">}</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">anything</span><span class="p">,</span> <span class="sr">/bar/</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"passes when the args match"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"barn"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"fails when the args do not match"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"other"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec basic_example_spec.rb</code></p>

<p><em>Then</em> it should fail with the following output:</p>

<table><thead>
<tr>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>2 examples, 1 failure</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>Failure/Error: dbl.foo(1, nil, &ldquo;other&rdquo;)</td>
</tr>
<tr>
<td>#<Double (anonymous)> received :foo with unexpected arguments</td>
</tr>
<tr>
<td>expected: (1, anything, /bar/)</td>
</tr>
<tr>
<td>got: (1, nil, &ldquo;other&rdquo;)</td>
</tr>
</tbody></table>

<h2>Using keyword arguments</h2>

<p><em>Given</em> a file named &ldquo;keyword<em>example</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">WithKeywords</span>
  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="ss">bar: </span><span class="s2">""</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Constraining a message expectation using with"</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:dbl</span><span class="p">)</span> <span class="p">{</span> <span class="n">instance_double</span><span class="p">(</span><span class="no">WithKeywords</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="ss">bar: </span><span class="s2">"baz"</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"passes when the args match"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="ss">bar: </span><span class="s2">"baz"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"fails when the args do not match"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="ss">bar: </span><span class="s2">"incorrect"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec keyword_example_spec.rb</code></p>

<p><em>Then</em> it should fail with the following output:</p>

<table><thead>
<tr>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>2 examples, 1 failure</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>Failure/Error: dbl.foo(bar: &ldquo;incorrect&rdquo;)</td>
</tr>
<tr>
<td>#<InstanceDouble(WithKeywords) (anonymous)> received :foo with unexpected arguments</td>
</tr>
<tr>
<td>expected: ({:bar=&gt;&ldquo;baz&rdquo;})</td>
</tr>
<tr>
<td>got: ({:bar=&gt;&ldquo;incorrect&rdquo;})</td>
</tr>
</tbody></table>

<h2>Using keyword arguments on Rubies that differentiate hashes from keyword arguments</h2>

<p><em>Given</em> a file named &ldquo;keyword<em>example</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">WithKeywords</span>
  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="ss">bar: </span><span class="s2">""</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Constraining a message expectation using with"</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:dbl</span><span class="p">)</span> <span class="p">{</span> <span class="n">instance_double</span><span class="p">(</span><span class="no">WithKeywords</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="ss">bar: </span><span class="s2">"baz"</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"fails when the args do not match due to a hash"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">({</span><span class="ss">bar: </span><span class="s2">"also incorrect"</span><span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec keyword_example_spec.rb</code></p>

<p><em>Then</em> it should fail with the following output:</p>

<table><thead>
<tr>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>1 example, 1 failure</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>Failure/Error: dbl.foo({bar: &ldquo;also incorrect&rdquo;})</td>
</tr>
<tr>
<td>#<InstanceDouble(WithKeywords) (anonymous)> received :foo with unexpected arguments</td>
</tr>
<tr>
<td>expected: ({:bar=&gt;&ldquo;baz&rdquo;}) (keyword arguments)</td>
</tr>
<tr>
<td>got: ({:bar=&gt;&ldquo;also incorrect&rdquo;}) (options hash)</td>
</tr>
</tbody></table>

<h2>Using a RSpec matcher</h2>

<p><em>Given</em> a file named &ldquo;rspec<em>matcher</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Using a RSpec matcher"</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:dbl</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span> <span class="p">}</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">a_collection_containing_exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"passes when the args match"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"fails when the args do not match"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec rspec_matcher_spec.rb</code></p>

<p><em>Then</em> it should fail with the following output:</p>

<table><thead>
<tr>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>2 examples, 1 failure</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>Failure/Error: dbl.foo([1, 3])</td>
</tr>
<tr>
<td>#<Double (anonymous)> received :foo with unexpected arguments</td>
</tr>
<tr>
<td>expected: (a collection containing exactly 1 and 2)</td>
</tr>
<tr>
<td>got: ([1, 3])</td>
</tr>
</tbody></table>

<h2>Using satisfy for complex custom expecations</h2>

<p><em>Given</em> a file named &ldquo;rspec<em>satisfy</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Using satisfy for complex custom expecations"</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:dbl</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">a_b_c_equals_5</span>
    <span class="n">satisfy</span> <span class="p">{</span> <span class="o">|</span><span class="n">data</span><span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="ss">:a</span><span class="p">][</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"passes when the expectation is true"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">a_b_c_equals_5</span><span class="p">)</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">({</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:c</span> <span class="o">=&gt;</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">}</span> <span class="p">})</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"fails when the expectation is false"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">a_b_c_equals_5</span><span class="p">)</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">({</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:c</span> <span class="o">=&gt;</span> <span class="mi">3</span> <span class="p">}</span> <span class="p">}</span> <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec rspec_satisfy_spec.rb</code></p>

<p><em>Then</em> it should fail with the following output:</p>

<table><thead>
<tr>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>2 examples, 1 failure</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>Failure/Error: dbl.foo({ :a =&gt; { :b =&gt; { :c =&gt; 3 } } })</td>
</tr>
<tr>
<td>#<Double (anonymous)> received :foo with unexpected arguments</td>
</tr>
<tr>
<td>expected: (satisfy expression <code>data[:a][:b][:c] == 5</code>)</td>
</tr>
<tr>
<td>got: ({:a=&gt;{:b=&gt;{:c=&gt;3}}})</td>
</tr>
</tbody></table>

<h2>Using a custom matcher</h2>

<p><em>Given</em> a file named &ldquo;custom<em>matcher</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span><span class="p">.</span><span class="nf">define</span> <span class="ss">:a_multiple_of</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="n">match</span> <span class="p">{</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span> <span class="p">(</span><span class="n">actual</span> <span class="o">%</span> <span class="n">x</span><span class="p">).</span><span class="nf">zero?</span> <span class="p">}</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Using a custom matcher"</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:dbl</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span> <span class="p">}</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">a_multiple_of</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">"passes when the args match"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"fails when the args do not match"</span> <span class="k">do</span>
    <span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec custom_matcher_spec.rb</code></p>

<p><em>Then</em> it should fail with the following output:</p>

<table><thead>
<tr>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>2 examples, 1 failure</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>Failure/Error: dbl.foo(13)</td>
</tr>
<tr>
<td>#<Double (anonymous)> received :foo with unexpected arguments</td>
</tr>
<tr>
<td>expected: (a multiple of 3)</td>
</tr>
<tr>
<td>got: (13)</td>
</tr>
</tbody></table>

<h2>Responding differently based on the arguments</h2>

<p><em>Given</em> a file named &ldquo;responding<em>differently</em>spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"Using #with to constrain responses"</span> <span class="k">do</span>
  <span class="n">specify</span> <span class="s2">"its response depends on the arguments"</span> <span class="k">do</span>
    <span class="n">dbl</span> <span class="o">=</span> <span class="n">double</span>

    <span class="c1"># Set a default for any unmatched args</span>
    <span class="n">allow</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="ss">:default</span><span class="p">)</span>

    <span class="n">allow</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">allow</span><span class="p">(</span><span class="n">dbl</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="mi">0</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="ss">:default</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">dbl</span><span class="p">.</span><span class="nf">foo</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec responding_differently_spec.rb</code></p>

<p><em>Then</em> the examples should all pass.</p>
</article></section><footer><div>Created with the assistance of Ninefold<img src="/images/brutus-half.png" alt="Brutus" /></div><br /><a href="https://dnsimple.link/resolving-rspec" target="_blank">Resolving with<br /><img src="https://cdn.dnsimple.com/assets/resolving-with-us/logo-dark.png" alt="DNSimple" style="width:100px;" /></a></footer></body><script src="/javascripts/asciinema-player.js"></script></html>