<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1" name="viewport" /><meta property="og:title" /><meta content="https://rspec.info/features/3-13/rspec-mocks/" property="og:url" /><meta content="https://rspec.info/images/logo_ogp.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="@rspec" name="twitter:site" /><title></title><link href="/stylesheets/pages/features.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" /></head><body class="features"><header><nav><h1><img src="/images/logo.png" alt="Logo" /><a href="/">RSpec</a></h1><input class="hamburger-toggle" type="checkbox" /><div class="hamburger-icon"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><ul class="menu"><li><a href="/about">About</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/blog">Blog</a></li><li><a href="/upgrading-from-rspec-2">Upgrade</a></li><li><a href="/help">Get Help</a></li><li><a href="/contributing">Contributing</a></li></ul></nav></header><nav class="top-nav-bar" role="navigation"><ul><li>Library:</li><li><a class="title" href="/features/3-13/rspec-mocks">RSpec Mocks</a><ul aria-haspopup="true" aria-label="submenu"><li><a href="/features/3-13/rspec-core">RSpec Core</a></li><li><a href="/features/3-13/rspec-expectations">RSpec Expectations</a></li><li class="current"><a href="/features/3-13/rspec-mocks">RSpec Mocks</a></li><li><a href="/features/6-1/rspec-rails">RSpec Rails</a></li></ul></li><li>Version:</li><li><a class="title" href="/features/3-13/rspec-mocks">3.13</a><ul aria-haspopup="true" aria-label="submenu"><li class="current"><a href="/features/3-13/rspec-mocks">3.13</a></li><li><a href="/features/3-12/rspec-mocks">3.12</a></li></ul></li></ul></nav><section><nav><ul><li><a href="/features/3-13/rspec-mocks/basics/">Basics</a><ul><li><a href="/features/3-13/rspec-mocks/basics/test-doubles/"> Test Doubles</a></li><li><a href="/features/3-13/rspec-mocks/basics/allowing-messages/"> Allowing messages</a></li><li><a href="/features/3-13/rspec-mocks/basics/expecting-messages/"> Expecting messages</a></li><li><a href="/features/3-13/rspec-mocks/basics/partial-test-doubles/"> Partial test doubles</a></li><li><a href="/features/3-13/rspec-mocks/basics/null-object-doubles/"> Null object doubles</a></li><li><a href="/features/3-13/rspec-mocks/basics/spies/"> Spies</a></li><li><a href="/features/3-13/rspec-mocks/basics/scope/"> Scope</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/">Verifying doubles</a><ul><li><a href="/features/3-13/rspec-mocks/verifying-doubles/instance-doubles/"> Using an instance double</a></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/class-doubles/"> Using a class double</a></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/object-doubles/"> Using an object double</a></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/dynamic-classes/"> Dynamic classes</a></li><li><a href="/features/3-13/rspec-mocks/verifying-doubles/partial-doubles/"> Partial doubles</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/">Configuring responses</a><ul><li><a href="/features/3-13/rspec-mocks/configuring-responses/returning-a-value/"> Returning a value</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/raising-an-error/"> Raising an error</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/throwing/"> Throwing</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/yielding/"> Yielding</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/calling-the-original-implementation/"> Calling the original implementation</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/wrapping-the-original-implementation/"> Wrapping the original implementation</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/block-implementation/"> Block implementation</a></li><li><a href="/features/3-13/rspec-mocks/configuring-responses/mixed-responses/"> Mixed responses</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/setting-constraints/">Setting constraints</a><ul><li><a href="/features/3-13/rspec-mocks/setting-constraints/matching-arguments/"> Matching arguments</a></li><li><a href="/features/3-13/rspec-mocks/setting-constraints/receive-counts/"> Receive Counts</a></li><li><a href="/features/3-13/rspec-mocks/setting-constraints/message-order/"> Message Order</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/mutating-constants/">Mutating constants</a><ul><li><a href="/features/3-13/rspec-mocks/mutating-constants/stub-defined-constant/"> Stub Defined Constant</a></li><li><a href="/features/3-13/rspec-mocks/mutating-constants/stub-undefined-constant/"> Stub Undefined Constant</a></li><li><a href="/features/3-13/rspec-mocks/mutating-constants/hide-defined-constant/"> Hide Defined Constant</a></li><li><a href="/features/3-13/rspec-mocks/mutating-constants/hide-undefined-constant/"> Hide Undefined Constant</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/working-with-legacy-code/">Working with legacy code</a><ul><li><a href="/features/3-13/rspec-mocks/working-with-legacy-code/any-instance/"> Any Instance</a></li><li><a href="/features/3-13/rspec-mocks/working-with-legacy-code/message-chains/"> Message Chains</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/old-syntax/">Old syntax</a><ul><li><a href="/features/3-13/rspec-mocks/old-syntax/stub/"> `stub`</a></li><li><a href="/features/3-13/rspec-mocks/old-syntax/should-receive/"> `should_receive`</a></li><li><a href="/features/3-13/rspec-mocks/old-syntax/any-instance/"> `any_instance`</a></li><li><a href="/features/3-13/rspec-mocks/old-syntax/stub-chain/"> `stub_chain`</a></li><li><a href="/features/3-13/rspec-mocks/old-syntax/unstub/"> Using `unstub`</a></li></ul></li><li><a href="/features/3-13/rspec-mocks/outside-rspec/">Outside rspec</a><ul><li><a href="/features/3-13/rspec-mocks/outside-rspec/minitest/"> Integrating with Minitest</a></li><li><a href="/features/3-13/rspec-mocks/outside-rspec/any-test-framework/"> Integrating with any test framework</a></li><li><a href="/features/3-13/rspec-mocks/outside-rspec/standalone/"> Using `rspec-mocks` on its own outside of RSpec (standalone mode)</a></li></ul></li></ul></nav><article><h1>RSpec Mocks</h1>

<p>rspec-mocks helps to control the context in a code example by letting you set known return
values, fake implementations of methods, and even set expectations that specific messages
are received by an object.</p>

<p>You can do these three things on test doubles that rspec-mocks creates for you on the fly, or
you can do them on objects that are part of your system.</p>

<h2>Messages and Methods</h2>

<p><em>Message</em> and <em>method</em> are metaphors that we use somewhat interchangeably, but they are
subtly different.  In Object Oriented Programming, objects communicate by sending
<em>messages</em> to one another. When an object receives a message, it invokes a <em>method</em> with the
same name as the message.</p>

<h2>Test Doubles</h2>

<p>A test double is an object that stands in for another object in your system during a code
example. Use the <code>double</code> method, passing in an optional identifier, to create one:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">book</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="s2">"book"</span><span class="p">)</span>
</code></pre></div>
<p>Most of the time you will want some confidence that your doubles resemble an existing
object in your system. Verifying doubles are provided for this purpose. If the existing object
is available, they will prevent you from adding stubs and expectations for methods that do
not exist or that have invalid arguments.</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">book</span> <span class="o">=</span> <span class="n">instance_double</span><span class="p">(</span><span class="s2">"Book"</span><span class="p">,</span> <span class="ss">:pages</span> <span class="o">=&gt;</span> <span class="mi">250</span><span class="p">)</span>
</code></pre></div>
<p><a href="/features/3-13/rspec-mocks/verifying-doubles/">Verifying doubles</a> have some clever tricks to enable you to both test in isolation without your
dependencies loaded while still being able to validate them against real objects.</p>

<h2>Method Stubs</h2>

<p>A method stub is an instruction to an object (real or test double) to return a
known value in response to a message:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">allow</span><span class="p">(</span><span class="n">die</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:roll</span><span class="p">)</span> <span class="p">{</span> <span class="mi">3</span> <span class="p">}</span>
</code></pre></div>
<p>This tells the <code>die</code> object to return the value <code>3</code> when it receives the <code>roll</code> message.</p>

<h2>Message Expectations</h2>

<p>A message expectation is an expectation that an object should receive a specific message
during the course of a code example:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">Account</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s2">"when closed"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"logs an 'account closed' message"</span> <span class="k">do</span>
      <span class="n">logger</span> <span class="o">=</span> <span class="n">double</span><span class="p">()</span>
      <span class="n">account</span> <span class="o">=</span> <span class="no">Account</span><span class="p">.</span><span class="nf">new</span>
      <span class="n">account</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="n">logger</span>

      <span class="n">expect</span><span class="p">(</span><span class="n">logger</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:account_closed</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>

      <span class="n">account</span><span class="p">.</span><span class="nf">close</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>This example specifies that the <code>account</code> object sends the <code>logger</code> the <code>account_closed</code>
message (with itself as an argument) when it receives the <code>close</code> message.</p>

<h2>Issues</h2>

<p>The documentation for rspec-mocks is a work in progress. We&rsquo;ll be adding Cucumber
features over time, and clarifying existing ones. If you have specific features you&rsquo;d like to see
added, find the existing documentation incomplete or confusing, or, better yet, wish to write
a missing Cucumber feature yourself, please <a href="http://github.com/rspec/rspec-mocks/issues">submit an issue</a> or a <a href="http://github.com/rspec/rspec-mocks">pull request</a>.</p>
</article></section><footer><div>Created with the assistance of Ninefold<img src="/images/brutus-half.png" alt="Brutus" /></div><br /><a href="https://dnsimple.link/resolving-rspec" target="_blank">Resolving with<br /><img src="https://cdn.dnsimple.com/assets/resolving-with-us/logo-dark.png" alt="DNSimple" style="width:100px;" /></a></footer></body><script src="/javascripts/asciinema-player.js"></script></html>