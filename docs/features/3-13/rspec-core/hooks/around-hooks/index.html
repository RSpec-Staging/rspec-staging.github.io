<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1" name="viewport" /><meta property="og:title" /><meta content="https://rspec.info/features/3-13/rspec-core/hooks/around-hooks/" property="og:url" /><meta content="https://rspec.info/images/logo_ogp.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="@rspec" name="twitter:site" /><title></title><link href="/stylesheets/pages/features.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" /></head><body class="features"><header><nav><h1><img src="/images/logo.png" alt="Logo" /><a href="/">RSpec</a></h1><input class="hamburger-toggle" type="checkbox" /><div class="hamburger-icon"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><ul class="menu"><li><a href="/about">About</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/blog">Blog</a></li><li><a href="/upgrading-from-rspec-2">Upgrade</a></li><li><a href="/help">Get Help</a></li><li><a href="/contributing">Contributing</a></li></ul></nav></header><nav class="top-nav-bar" role="navigation"><ul><li>Library:</li><li><a class="title" href="/features/3-13/rspec-core">RSpec Core</a><ul aria-haspopup="true" aria-label="submenu"><li class="current"><a href="/features/3-13/rspec-core">RSpec Core</a></li><li><a href="/features/3-13/rspec-expectations">RSpec Expectations</a></li><li><a href="/features/3-13/rspec-mocks">RSpec Mocks</a></li><li><a href="/features/6-1/rspec-rails">RSpec Rails</a></li></ul></li><li>Version:</li><li><a class="title" href="/features/3-13/rspec-core">3.13</a><ul aria-haspopup="true" aria-label="submenu"><li class="current"><a href="/features/3-13/rspec-core">3.13</a></li><li><a href="/features/3-12/rspec-core">3.12</a></li></ul></li></ul></nav><section><nav><ul><li><a href="/features/3-13/rspec-core/example-groups/">Example groups</a><ul><li><a href="/features/3-13/rspec-core/example-groups/basic-structure/"> The basic structure (`describe`/`it`)</a></li><li><a href="/features/3-13/rspec-core/example-groups/shared-examples/"> Using shared examples</a></li><li><a href="/features/3-13/rspec-core/example-groups/shared-context/"> Using `shared_context`</a></li><li><a href="/features/3-13/rspec-core/example-groups/aliasing/"> Aliasing</a></li></ul></li><li><a href="/features/3-13/rspec-core/command-line/">Command line</a><ul><li><a href="/features/3-13/rspec-core/command-line/example-name-option/"> `--example` option</a></li><li><a href="/features/3-13/rspec-core/command-line/format-option/"> `--format` option</a></li><li><a href="/features/3-13/rspec-core/command-line/tag/"> `--tag` option</a></li><li><a href="/features/3-13/rspec-core/command-line/line-number-appended-to-path/"> `&lt;file&gt;:&lt;line_number&gt;` (line number appended to file path)</a></li><li><a href="/features/3-13/rspec-core/command-line/exit-status/"> `--failure-exit-code` option (exit status)</a></li><li><a href="/features/3-13/rspec-core/command-line/order/">`--order` option</a></li><li><a href="/features/3-13/rspec-core/command-line/rake-task/"> Creating a rake task</a></li><li><a href="/features/3-13/rspec-core/command-line/order/"> Using the `--order` option</a></li><li><a href="/features/3-13/rspec-core/command-line/ruby/"> Run with `ruby` command</a></li><li><a href="/features/3-13/rspec-core/command-line/warnings-option/"> `--warnings` option (run with warnings enabled)</a></li><li><a href="/features/3-13/rspec-core/command-line/init/"> `--init` option</a></li><li><a href="/features/3-13/rspec-core/command-line/example-matches-name-option/"> `--example-matches` option</a></li><li><a href="/features/3-13/rspec-core/command-line/bisect/"> Bisect</a></li><li><a href="/features/3-13/rspec-core/command-line/only-failures/"> Using the `--only-failures` option</a></li><li><a href="/features/3-13/rspec-core/command-line/fail-fast/"> `--fail-fast` option</a></li><li><a href="/features/3-13/rspec-core/command-line/dry-run/"> `--dry-run` option</a></li><li><a href="/features/3-13/rspec-core/command-line/randomization/"> Randomization can be reproduced across test runs</a></li><li><a href="/features/3-13/rspec-core/command-line/pattern-option/"> `--pattern` option</a></li><li><a href="/features/3-13/rspec-core/command-line/require-option/"> `--require` option</a></li></ul></li><li><a href="/features/3-13/rspec-core/pending-and-skipped-examples/">Pending and skipped examples</a><ul><li><a href="/features/3-13/rspec-core/pending-and-skipped-examples/pending-examples/"> Using `pending` with examples</a></li><li><a href="/features/3-13/rspec-core/pending-and-skipped-examples/skipped-examples/"> Using `skip` with examples</a></li></ul></li><li><a href="/features/3-13/rspec-core/hooks/">Hooks</a><ul class="open"><li><a href="/features/3-13/rspec-core/hooks/before-and-after-hooks/"> `before` and `after` hooks</a></li><li><a href="/features/3-13/rspec-core/hooks/around-hooks/"> `around` hooks</a></li><li><a href="/features/3-13/rspec-core/hooks/filtering/"> Filtering</a></li><li><a href="/features/3-13/rspec-core/hooks/when-first-matching-example-defined/"> Using `when_first_matching_example_defined` hook</a></li></ul></li><li><a href="/features/3-13/rspec-core/subject/">Subject</a><ul><li><a href="/features/3-13/rspec-core/subject/implicit-subject/"> Implicitly defined subject</a></li><li><a href="/features/3-13/rspec-core/subject/explicit-subject/"> Explicit Subject</a></li><li><a href="/features/3-13/rspec-core/subject/one-liner-syntax/"> One-liner syntax</a></li></ul></li><li><a href="/features/3-13/rspec-core/helper-methods/">Helper methods</a><ul><li><a href="/features/3-13/rspec-core/helper-methods/let/"> `let` and `let!`</a></li><li><a href="/features/3-13/rspec-core/helper-methods/arbitrary-methods/"> Defining arbitrary helper methods</a></li><li><a href="/features/3-13/rspec-core/helper-methods/modules/"> Define helper methods in a module</a></li></ul></li><li><a href="/features/3-13/rspec-core/metadata/">Metadata</a><ul><li><a href="/features/3-13/rspec-core/metadata/current-example/"> Using the current example</a></li><li><a href="/features/3-13/rspec-core/metadata/described-class/"> Using `described_class`</a></li><li><a href="/features/3-13/rspec-core/metadata/user-defined/"> User-defined metadata</a></li><li><a href="/features/3-13/rspec-core/metadata/current-scope/"> `RSpec` provides the current scope as `RSpec.current_scope`</a></li></ul></li><li><a href="/features/3-13/rspec-core/filtering/">Filtering</a><ul><li><a href="/features/3-13/rspec-core/filtering/inclusion-filters/"> Inclusion filters</a></li><li><a href="/features/3-13/rspec-core/filtering/exclusion-filters/"> Exclusion filters</a></li><li><a href="/features/3-13/rspec-core/filtering/if-and-unless/"> Conditional Filters</a></li><li><a href="/features/3-13/rspec-core/filtering/filter-run-when-matching/"> Using `filter_run_when_matching`</a></li></ul></li><li><a href="/features/3-13/rspec-core/configuration/">Configuration</a><ul><li><a href="/features/3-13/rspec-core/configuration/read-options-from-file/"> Reading command line configuration options from files</a></li><li><a href="/features/3-13/rspec-core/configuration/color/"> Windows may require additional solutions to display color</a></li><li><a href="/features/3-13/rspec-core/configuration/fail-fast/"> Setting the `fail_fast` option</a></li><li><a href="/features/3-13/rspec-core/configuration/fail-if-no-examples/"> Setting the `fail_if_no_examples` option</a></li><li><a href="/features/3-13/rspec-core/configuration/custom-settings/"> Custom settings</a></li><li><a href="/features/3-13/rspec-core/configuration/alias-example-to/"> Create example aliases</a></li><li><a href="/features/3-13/rspec-core/configuration/default-path/"> Setting the default spec path</a></li><li><a href="/features/3-13/rspec-core/configuration/pattern/"> Using the `--pattern` option</a></li><li><a href="/features/3-13/rspec-core/configuration/run-all-when-everything-filtered/"> Using `run_all_when_everything_filtered`</a></li><li><a href="/features/3-13/rspec-core/configuration/overriding-global-ordering/"> Overriding global ordering</a></li><li><a href="/features/3-13/rspec-core/configuration/profile/"> Profiling examples (`--profile`)</a></li><li><a href="/features/3-13/rspec-core/configuration/error-exit-code/"> Setting an error exit code</a></li><li><a href="/features/3-13/rspec-core/configuration/failure-exit-code/"> Setting a failure exit code</a></li><li><a href="/features/3-13/rspec-core/configuration/order-and-seed/"> Setting the `--order` and/or `--seed`</a></li><li><a href="/features/3-13/rspec-core/configuration/exclude-pattern/"> Using the `--exclude_pattern` option</a></li><li><a href="/features/3-13/rspec-core/configuration/enable-global-dsl/"> Global namespace DSL</a></li><li><a href="/features/3-13/rspec-core/configuration/deprecation-stream/"> Custom deprecation stream</a></li><li><a href="/features/3-13/rspec-core/configuration/output-stream/"> Custom output stream</a></li><li><a href="/features/3-13/rspec-core/configuration/pending-failure-output/"> Configuring pending failure output</a></li><li><a href="/features/3-13/rspec-core/configuration/backtrace-exclusion-patterns/"> Excluding lines from the backtrace</a></li><li><a href="/features/3-13/rspec-core/configuration/zero-monkey-patching-mode/"> Zero monkey patching mode</a></li></ul></li><li><a href="/features/3-13/rspec-core/expectation-framework-integration/">Expectation framework integration</a><ul><li><a href="/features/3-13/rspec-core/expectation-framework-integration/configure-expectation-framework/"> Configuring an expectation framework</a></li><li><a href="/features/3-13/rspec-core/expectation-framework-integration/aggregating-failures/"> Aggregating Failures</a></li></ul></li><li><a href="/features/3-13/rspec-core/mock-framework-integration/">Mock framework integration</a><ul><li><a href="/features/3-13/rspec-core/mock-framework-integration/use-rspec/"> Mocking with `rspec`</a></li><li><a href="/features/3-13/rspec-core/mock-framework-integration/use-flexmock/"> Mocking with `flexmock`</a></li><li><a href="/features/3-13/rspec-core/mock-framework-integration/use-mocha/"> Mocking with `mocha`</a></li><li><a href="/features/3-13/rspec-core/mock-framework-integration/use-rr/"> Mocking with `rr`</a></li><li><a href="/features/3-13/rspec-core/mock-framework-integration/use-any-framework/"> Mocking with an alternative framework</a></li></ul></li><li><a href="/features/3-13/rspec-core/formatters/">Formatters</a><ul><li><a href="/features/3-13/rspec-core/formatters/configurable-colors/"> Configurable colors</a></li><li><a href="/features/3-13/rspec-core/formatters/json-formatter/"> The JSON formatter</a></li><li><a href="/features/3-13/rspec-core/formatters/custom-formatter/"> Custom formatters</a></li></ul></li><li><a href="/features/3-13/rspec-core/spec-files/">Spec files</a><ul><li><a href="/features/3-13/rspec-core/spec-files/arbitrary-file-suffix/"> Using an arbitrary file suffix</a></li></ul></li><li><a href="/features/3-13/rspec-core/core-standalone/">Core standalone</a></li><li><a href="/features/3-13/rspec-core/clear-examples/">Clear examples</a></li></ul></nav><article><h1><code>around</code> hooks</h1>

<p><code>around</code> hooks receive the example as a block argument, extended to behave as
  a proc. This lets you define code that should be executed before and after the
  example. Of course, you can do the same thing with <code>before</code> and <code>after</code> hooks;
  and it&rsquo;s often cleaner to do so.</p>

<p>Where <code>around</code> hooks shine is when you want to run an example within a block.
  For instance, if your database library offers a transaction method that
  receives a block, you can use an <code>around</code> to cleanly open and close the
  transaction around the example.</p>

<p><strong>WARNING:</strong> <code>around</code> hooks do not share state with the example the way
  <code>before</code> and <code>after</code> hooks do. This means that you cannot share instance
  variables between <code>around</code> hooks and examples.</p>

<p><strong>WARNING:</strong> Mock frameworks are set up and torn down within the context of
  running the example. You cannot interact with them directly in <code>around</code> hooks.</p>

<p><strong>WARNING:</strong> <code>around</code> hooks will execute <em>before</em> any <code>before</code> hooks, and <em>after</em>
  any <code>after</code> hooks regardless of the context they were defined in.</p>

<h2>Use the example as a proc within the block passed to <code>around()</code></h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Database</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">transaction</span>
    <span class="nb">puts</span> <span class="s2">"open transaction"</span>
    <span class="k">yield</span>
    <span class="nb">puts</span> <span class="s2">"close transaction"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"around filter"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="no">Database</span><span class="p">.</span><span class="nf">transaction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">example</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"gets run in order"</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"run the example"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>open transaction
run the example
close transaction
</code></pre></div>
<h2>Invoke the example using <code>run()</code></h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"around hook"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"around example before"</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="nb">puts</span> <span class="s2">"around example after"</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"gets run in order"</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"in the example"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>around example before
in the example
around example after
</code></pre></div>
<h2>Access the example metadata</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"something"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="n">example</span><span class="p">.</span><span class="nf">metadata</span><span class="p">[</span><span class="ss">:foo</span><span class="p">]</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"does something"</span><span class="p">,</span> <span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="s2">"this should show up in the output"</span> <span class="k">do</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain &ldquo;this should show up in the output&rdquo;.</p>

<h2>An around hook continues to run even if the example throws an exception</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code>  <span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"something"</span> <span class="k">do</span>
    <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"around example setup"</span>
      <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
      <span class="nb">puts</span> <span class="s2">"around example cleanup"</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">"still executes the entire around hook"</span> <span class="k">do</span>
      <span class="nb">fail</span> <span class="s2">"the example blows up"</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain &ldquo;1 example, 1 failure&rdquo;</p>

<p><em>And</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>around example setup
around example cleanup
</code></pre></div>
<h2>Define a global <code>around</code> hook</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"around example before"</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="nb">puts</span> <span class="s2">"around example after"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"around filter"</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"gets run in order"</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"in the example"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>around example before
in the example
around example after
</code></pre></div>
<h2>Per example hooks are wrapped by the <code>around</code> hook</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"around filter"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"around example before"</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="nb">puts</span> <span class="s2">"around example after"</span>
  <span class="k">end</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"before example"</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"after example"</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"gets run in order"</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"in the example"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>around example before
before example
in the example
after example
around example after
</code></pre></div>
<h2>Context hooks are NOT wrapped by the <code>around</code> hook</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"around filter"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"around example before"</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="nb">puts</span> <span class="s2">"around example after"</span>
  <span class="k">end</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:context</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"before context"</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:context</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"after context"</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"gets run in order"</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"in the example"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec --format progress example_spec.rb</code></p>

<p><em>Then</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>before context
around example before
in the example
around example after
.after context
</code></pre></div>
<h2>Examples run by an <code>around</code> block are run in the configured context</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">module</span> <span class="nn">IncludedInConfigureBlock</span>
  <span class="k">def</span> <span class="nf">included_in_configure_block</span><span class="p">;</span> <span class="kp">true</span><span class="p">;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">include</span> <span class="no">IncludedInConfigureBlock</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"around filter"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"runs the example in the correct context"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">included_in_configure_block</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain &ldquo;1 example, 0 failure&rdquo;.</p>

<h2>Implicitly pending examples are detected as Not yet implemented</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"implicit pending example"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"should be detected as Not yet implemented"</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain &ldquo;1 example, 0 failures, 1 pending&rdquo;</p>

<p><em>And</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Pending: (Failures listed here are expected and do not affect your suite's status)

  1) implicit pending example should be detected as Not yet implemented
     # Not yet implemented
     # ./example_spec.rb:6
</code></pre></div>
<h2>Explicitly pending examples are detected as pending</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"explicit pending example"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"should be detected as pending"</span> <span class="k">do</span>
    <span class="n">pending</span>
    <span class="nb">fail</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain &ldquo;1 example, 0 failures, 1 pending&rdquo;</p>

<p><em>And</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Pending: (Failures listed here are expected and do not affect your suite's status)

  1) explicit pending example should be detected as pending
     # No reason given
</code></pre></div>
<h2>Multiple <code>around</code> hooks in the same scope</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"if there are multiple around hooks in the same scope"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"first around hook before"</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="nb">puts</span> <span class="s2">"first around hook after"</span>
  <span class="k">end</span>

  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"second around hook before"</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="nb">puts</span> <span class="s2">"second around hook after"</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"they should all be run"</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s2">"in the example"</span>
    <span class="n">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain &ldquo;1 example, 0 failure&rdquo;</p>

<p><em>And</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>first around hook before
second around hook before
in the example
second around hook after
first around hook after
</code></pre></div>
<h2><code>around</code> hooks in multiple scopes</h2>

<p><em>Given</em> a file named &ldquo;example_spec.rb&rdquo; with:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="s2">"if there are around hooks in an outer scope"</span> <span class="k">do</span>
  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"first outermost around hook before"</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="nb">puts</span> <span class="s2">"first outermost around hook after"</span>
  <span class="k">end</span>

  <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"second outermost around hook before"</span>
    <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
    <span class="nb">puts</span> <span class="s2">"second outermost around hook after"</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">"outer scope"</span> <span class="k">do</span>
    <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"first outer around hook before"</span>
      <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
      <span class="nb">puts</span> <span class="s2">"first outer around hook after"</span>
    <span class="k">end</span>

    <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
      <span class="nb">puts</span> <span class="s2">"second outer around hook before"</span>
      <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
      <span class="nb">puts</span> <span class="s2">"second outer around hook after"</span>
    <span class="k">end</span>

    <span class="n">describe</span> <span class="s2">"inner scope"</span> <span class="k">do</span>
      <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
        <span class="nb">puts</span> <span class="s2">"first inner around hook before"</span>
        <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
        <span class="nb">puts</span> <span class="s2">"first inner around hook after"</span>
      <span class="k">end</span>

      <span class="n">around</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
        <span class="nb">puts</span> <span class="s2">"second inner around hook before"</span>
        <span class="n">example</span><span class="p">.</span><span class="nf">run</span>
        <span class="nb">puts</span> <span class="s2">"second inner around hook after"</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s2">"they should all be run"</span> <span class="k">do</span>
        <span class="nb">puts</span> <span class="s2">"in the example"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p><em>When</em> I run <code>rspec example_spec.rb</code></p>

<p><em>Then</em> the output should contain &ldquo;1 example, 0 failure&rdquo;</p>

<p><em>And</em> the output should contain:</p>
<div class="highlight"><pre class="highlight plaintext"><code>first outermost around hook before
second outermost around hook before
first outer around hook before
second outer around hook before
first inner around hook before
second inner around hook before
in the example
second inner around hook after
first inner around hook after
second outer around hook after
first outer around hook after
second outermost around hook after
first outermost around hook after
</code></pre></div></article></section><footer><div>Created with the assistance of Ninefold<img src="/images/brutus-half.png" alt="Brutus" /></div><br /><a href="https://dnsimple.link/resolving-rspec" target="_blank">Resolving with<br /><img src="https://cdn.dnsimple.com/assets/resolving-with-us/logo-dark.png" alt="DNSimple" style="width:100px;" /></a></footer></body><script src="/javascripts/asciinema-player.js"></script></html>